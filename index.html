<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- æ ¸å¿ƒä¿®å¾©ï¼šè¨­å®šç€è¦½å™¨ä¸»é¡Œè‰²ç‚ºç™½è‰²ï¼Œé¿å…ç‹€æ…‹åˆ—è®Šç´… -->
    <meta name="theme-color" content="#FFFFFF">
    <title>Jesus Vibes 2026 - åŸºç£å¾’éå¹´æ±‚ç”ŸåŒ…</title>

    <!-- App åœ–ç¤ºä¿®å¾©ï¼šä½¿ç”¨éœæ…‹ç·¨ç¢¼çš„ SVG Data URI -->
    <!-- é€™èƒ½ç¢ºä¿æ‰‹æ©Ÿã€ŒåŠ å…¥ä¸»ç•«é¢ã€æ™‚èƒ½æŠ“åˆ°æ­£ç¢ºçš„ç´…åº•é‡‘åå­—æ¶åœ–ç¤ºï¼Œç„¡éœ€ç­‰å¾… JS åŸ·è¡Œ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='100' fill='%238E1E20'/%3E%3Cpath fill='%23E6B450' d='M226 60h60v140h140v60H286v192h-60V260H86v-60h140V60z'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='100' fill='%238E1E20'/%3E%3Cpath fill='%23E6B450' d='M226 60h60v140h140v60H286v192h-60V260H86v-60h140V60z'/%3E%3C/svg%3E">
      
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
      
    <!-- HTML2Canvas (For Screenshot Sharing) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      
    <!-- PapaParse (For Google Sheets CSV Parsing) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
      
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
      
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --ny-red-deep: #8E1E20;
            --ny-red-soft: #B74646;
            --ny-green-pine: #4A6351;
            --ny-gold: #E6B450;
            --ny-blue-royal: #2C3E50;
            --ny-purple: #6A1B9A;
            --ny-paper: #FFFDF5;
            --text-main: #5C2828;
            --main-font: "Nunito", "PingFang TC", "Microsoft JhengHei", "Noto Sans TC", system-ui, sans-serif;
            --title-font: "Noto Serif TC", "Songti TC", "Microsoft JhengHei", serif;
            --nav-height: 60px;
        }

        /* ç¢ºä¿å…¨åŸŸèƒŒæ™¯ç‚ºç™½è‰² */
        html {
            background-color: #FFFFFF;
        }
        
        body {
            width: 100%; 
            height: 100%; 
            min-height: 100vh;
            min-height: 100dvh;
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            background-color: #FFFFFF; /* é›™é‡ä¿éšª */
            color: var(--text-main); 
            font-family: var(--main-font);
            overscroll-behavior: none; 
            position: fixed; 
            inset: 0;
            display: flex;
            justify-content: center; /* å…§å®¹ç½®ä¸­ */
        }

        /* èƒŒæ™¯å±¤ï¼šé™åˆ¶åœ¨ App å®¹å™¨å…§ï¼Œé¿å…æº¢å‡ºåˆ°ç€è¦½å™¨èƒŒæ™¯ */
        #bg-layer {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -10; 
            background: linear-gradient(160deg, #8E1E20 0%, #A63437 40%, #5E1214 100%);
            overflow: hidden; 
            pointer-events: none;
            transform: translateZ(0); 
            will-change: transform; 
        }

        /* App ä¸»å®¹å™¨ï¼šé™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œæ¨¡æ“¬æ‰‹æ©Ÿé«”é©—ï¼Œä¸¦æ·»åŠ é™°å½±å€éš” */
        #app-root {
            position: relative;
            width: 100%; 
            max-width: 500px; 
            height: 100%;
            background-color: var(--ny-red-deep); /* åªæœ‰é€™è£¡é¡¯ç¤ºç´…è‰²èƒŒæ™¯ */
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            z-index: 10;
            opacity: 0; 
            transition: opacity 0.5s ease-out;
            box-shadow: 0 0 40px rgba(0,0,0,0.1); /* å¢åŠ é™°å½±è®“å®ƒèˆ‡ç™½åº•å€éš” */
        }

        /* 4. å°è¦½åˆ— */
        #inner-nav-bar {
            position: relative; width: 100%; height: var(--nav-height);
            display: none; align-items: center; justify-content: space-between;
            background: rgba(142, 30, 32, 0.98); 
            padding: 0 16px; z-index: 100;
            border-bottom: 1px solid rgba(230, 180, 80, 0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); flex-shrink: 0;
        }

        /* 5. å…§å®¹æ²å‹•å€ */
        #scroll-wrapper {
            flex: 1; width: 100%; overflow-y: auto; overflow-x: hidden;
            -webkit-overflow-scrolling: touch; position: relative; padding-bottom: 40px; 
        }

        .app-container {
            width: 100%; margin: 0 auto;
            display: flex; flex-direction: column; align-items: center;
            padding-top: 20px; padding-left: 16px; padding-right: 16px;
            padding-bottom: 120px; 
        }

        /* Header Style */
        #home-header {
            width: 100%; text-align: center; margin-bottom: 20px;
            transition: opacity 0.3s; margin-top: 60px; cursor: pointer;
        }

        .nav-back-btn {
            display: flex; align-items: center; gap: 8px; color: var(--ny-gold);
            font-weight: 700; font-size: 1rem; cursor: pointer; height: 100%;
            user-select: none; padding-right: 15px;
        }

        .nav-title {
            color: white; font-size: 1rem; opacity: 0.95; font-weight: 700;
            font-family: var(--title-font); letter-spacing: 1px;
        }

        .view-container { width: 100%; animation: fadeIn 0.3s ease-out; }

        .ny-card {
            background: rgba(255, 253, 245, 0.98);
            border-radius: 24px; border: 2px solid var(--ny-gold);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); position: relative;
            width: 100%; padding: 24px 20px; margin-bottom: 20px; margin-top: 20px;
            transform: translateZ(0);
        }

        /* Menu Grid */
        .menu-grid {
             display: grid; grid-template-columns: repeat(2, 1fr);
             gap: 16px; width: 100%; margin-top: 10px;
        }

        .menu-btn {
            min-height: 150px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--ny-paper); border-radius: 24px; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 6px solid #dcdcdc; box-shadow: 0 6px 12px rgba(0,0,0,0.08);
            padding: 16px; width: 100%; position: relative; overflow: hidden;
        }
        .menu-btn:active { transform: translateY(4px); border-bottom-width: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
          
        .icon-bg { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; margin-bottom: 12px; flex-shrink: 0;}

        /* Color System */
        .bg-ny-red { background: #FDE8E8; color: var(--ny-red-soft); border: 2px solid #FAB1B1; }
        .bg-ny-green { background: #E8F5E9; color: var(--ny-green-pine); border: 2px solid #C8E6C9; }
        .bg-ny-blue { background: #EBF5FB; color: var(--ny-blue-royal); border: 2px solid #AED6F1; }
        .bg-ny-purple { background: #F3E5F5; color: #7B1FA2; border: 2px solid #E1BEE7; }

        .forest-btn { flex: 1; padding: 14px; color: white; border-radius: 16px; font-weight: 700; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 8px; border-bottom-width: 4px; transition: all 0.1s; letter-spacing: 1px; }
        .forest-btn:active { transform: translateY(3px); border-bottom-width: 1px; }
          
        .btn-red { background: var(--ny-red-soft); border-bottom-color: #8E1E20; }
        .btn-green { background: var(--ny-green-pine); border-bottom-color: #2F4234; }
        .btn-gold { background: var(--ny-gold); border-bottom-color: #B38628; color: #5C2828; }
        .btn-blue { background: #34495E; border-bottom-color: #1A252F; color: #fff; }
        .btn-purple { background: #8E24AA; border-bottom-color: #4A148C; color: #fff; }

        .story-input { 
            width: 100%; padding: 16px; border: 2px solid var(--ny-gold); 
            border-radius: 18px; background: #FFFEFA; outline: none; 
            color: var(--text-main); font-size: 16px; line-height: 1.5; resize: none; 
        } 
        .story-input:focus { border-color: var(--ny-red-soft); box-shadow: 0 0 0 4px rgba(183, 70, 70, 0.1); }

        .scratch-box { position: relative; width: 100%; height: 180px; margin: 0 auto; border-radius: 12px; overflow: hidden; background: #fff; border: 3px dashed var(--ny-red-soft); }
        .action-group { display: flex; gap: 12px; margin-top: 24px; width: 100%; }

        /* Style Options */
        .style-options { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .style-pill {
            padding: 12px 5px; border-radius: 12px; font-size: 0.95rem; font-weight: 700; text-align: center; cursor: pointer;
            border: 2px solid transparent; background: #F5F5F5; color: #666; transition: all 0.2s;
            user-select: none; display: flex; align-items: center; justify-content: center;
        }
        .style-pill.active { background: #8E24AA; color: white; box-shadow: 0 4px 10px rgba(142, 36, 170, 0.3); transform: scale(1.02); }
          
        .style-pill[data-style="toxic"].active { background: #C62828; }
        .style-pill[data-style="funny"].active { background: #F9A825; color: #4E342E; }
        .style-pill[data-style="pun"].active { background: #52525b; color: #fff; } 
        .style-pill[data-style="gentle"].active { background: #EC407A; }
        .style-pill[data-style="childish"].active { background: #2DD4BF; color: #000; }
        .style-pill[data-style="drama"].active { background: #BE123C; color: #fff; }
        .style-pill[data-style="ancient"].active { background: #795548; }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .toast { visibility: hidden; min-width: 260px; background-color: var(--ny-red-deep); color: var(--ny-gold); text-align: center; border-radius: 50px; padding: 16px 24px; position: fixed; z-index: 10000; left: 50%; bottom: 80px; transform: translateX(-50%); font-weight: 700; box-shadow: 0 10px 30px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s, transform 0.3s; border: 1px solid var(--ny-gold); font-size: 0.95rem; pointer-events: none;}
        .toast.show { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(-10px); }
          
        /* Decorations */
        .streamlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.15; background-image: repeating-linear-gradient(45deg, transparent, transparent 20px, #E6B450 20px, #E6B450 22px); pointer-events: none; }
        
        .stars-container { position: absolute; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star {
            position: absolute; background-color: #FFF;
            clip-path: polygon(50% 0%, 65% 40%, 100% 50%, 65% 60%, 50% 100%, 35% 60%, 0% 50%, 35% 40%);
            opacity: 0; animation: twinkle infinite ease-in-out;
            will-change: transform, opacity;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 10px #FFF; }
        }
          
        .lantern-container { 
            position: absolute; top: 0; left: 0; width: 100%; display: flex; 
            justify-content: space-between; padding: 10px 10px 0 10px; 
            z-index: 120; pointer-events: none; opacity: 1; visibility: visible;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0s; 
        }
        .lantern-container.hide-lanterns { 
            opacity: 0; 
            visibility: hidden; 
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s; 
        }
        
        .lantern { width: 60px; height: 80px; background: #D32F2F; border-radius: 20px; border: 2px solid #5E1214; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2); animation: swing 6s infinite ease-in-out; transform-origin: top center; will-change: transform; }
        .lantern::before { content: ''; position: absolute; top: -5px; left: 10px; width: 36px; height: 8px; background: #E6B450; border-radius: 4px; }
        .lantern::after { content: ''; position: absolute; bottom: -20px; left: 25px; width: 4px; height: 20px; background: #E6B450; box-shadow: 0 5px 0 #D32F2F, 0 10px 0 #D32F2F; }
        .lantern-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #E6B450; font-weight: 900; font-size: 24px; border: 2px solid #E6B450; border-radius: 50%; width: 40px; height: 40px; line-height: 36px; text-align: center; font-family: var(--title-font); }
        .l-left { animation-delay: 0s; } .l-right { animation-delay: 1s; }
        @keyframes swing { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
          
        .waves-container { position: absolute; bottom: 0; width: 100%; height: 200px; z-index: 1; pointer-events: none;}
        .wave { position: absolute; bottom: 0; left: 0; width: 200%; height: 100%; background-repeat: repeat-x; background-position: bottom; background-size: 50% 100%; will-change: transform; }
        .wave-green { bottom: -20px; height: 180px; opacity: 0.9; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%234A6351' fill-opacity='1' d='M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,250.7C960,235,1056,181,1152,165.3C1248,149,1344,171,1392,181.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E"); animation: waveMove 20s linear infinite; }
        .wave-gold { bottom: -10px; height: 120px; opacity: 0.6; z-index: 1; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23E6B450' fill-opacity='1' d='M0,128L60,138.7C120,149,240,171,360,165.3C480,160,600,128,720,128C840,128,960,160,1080,176C1200,192,1320,192,1380,192L1440,192L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z'%3E%3C/path%3E%3C/svg%3E"); animation: waveMove 15s linear infinite reverse; }
        @keyframes waveMove { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        footer { margin-top: auto; color: rgba(255,255,255,0.7); font-size: 12px; padding-bottom: 20px; margin-top: 40px; text-align: center; }
          
        .social-link { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.9); margin: 0 8px; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.2); }
        .social-link:hover { background: var(--ny-gold); color: var(--ny-red-deep); transform: translateY(-3px); border-color: var(--ny-gold); }

        h1, h2, .title-font { font-family: var(--title-font); }
          
        /* Book Animation Styles */
        .perspective-1000 { perspective: 1000px; }
        .book-flip-enter { animation: bookFlipEnter 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes bookFlipEnter { 
            0% { opacity: 0; transform: rotateY(-90deg) scale(0.9); } 
            100% { opacity: 1; transform: rotateY(0) scale(1); } 
        }
          
        /* Poke Game Styles */
        .poke-box {
            position: relative; width: 100%; padding-bottom: 100%; background: #2D3436; 
            border-radius: 12px; overflow: hidden; cursor: pointer;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); -webkit-tap-highlight-color: transparent;
        }
        .poke-paper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid rgba(255,255,255,0.2); border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1); transform-origin: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .poke-box.poked .poke-paper { opacity: 0; transform: scale(1.5); pointer-events: none; }
        .poke-box:active .poke-paper { transform: scale(0.95); }

        /* Status Indicator */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-success { background-color: #4CAF50; box-shadow: 0 0 5px #4CAF50; }
        .status-error { background-color: #F44336; box-shadow: 0 0 5px #F44336; }

        /* First Aid Kit Specific Styles */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .medicine-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 12px; border-radius: 12px; cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid transparent;
            min-height: 90px; text-align: center; background: white;
        }
        .medicine-item:active { transform: scale(0.96); }
        .medicine-item.active { border-color: #8E1E20; box-shadow: 0 0 0 2px rgba(142, 30, 32, 0.2); }

        .hot-tag-btn {
            display: inline-flex; align-items: center; padding: 8px 16px;
            border-radius: 999px; font-weight: 700; font-size: 0.9rem;
            cursor: pointer; white-space: nowrap; flex-shrink: 0;
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            border: 1px solid transparent;
        }
        .hot-tag-btn:active { transform: scale(0.95); }
        
        .tag-money { background: #ECFDF5; color: #047857; border-color: #A7F3D0; }
        .tag-angry { background: #FEF2F2; color: #B91C1C; border-color: #FECACA; }
        .tag-tired { background: #EFF6FF; color: #1D4ED8; border-color: #BFDBFE; }
        .tag-lonely { background: #FAF5FF; color: #7E22CE; border-color: #E9D5FF; }
        .tag-lost { background: #FFFBEB; color: #B45309; border-color: #FDE68A; }
        .tag-full { background: #FFF1F2; color: #BE123C; border-color: #FECDD3; }
        .tag-gray { background: #F3F4F6; color: #374151; border-color: #E5E7EB; }

        /* Quiz Styles */
        .quiz-option {
            width: 100%; text-align: left; padding: 16px; 
            border: 2px solid #E1F5FE; background: white; border-radius: 16px; 
            margin-bottom: 12px; transition: all 0.2s; cursor: pointer;
            display: flex; align-items: center; gap: 12px;
        }
        .quiz-option:active { transform: scale(0.98); }
        .quiz-option.selected-correct { background: #E8F5E9; border-color: #4CAF50; color: #1B5E20; }
        .quiz-option.selected-wrong { background: #FFEBEE; border-color: #EF5350; color: #B71C1C; }
        .quiz-circle {
            width: 28px; height: 28px; border-radius: 50%; background: #F5F5F5; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; 
            font-size: 14px; color: #888; flex-shrink: 0;
        }
        .quiz-option.selected-correct .quiz-circle { background: #4CAF50; color: white; }
        .quiz-option.selected-wrong .quiz-circle { background: #EF5350; color: white; }

        /* Heavenly Red Envelope Styles */
        .red-envelope-container {
            perspective: 1000px; width: 280px; height: 380px; margin: 20px auto; cursor: pointer;
        }
        .red-envelope {
            width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .red-envelope.opened { transform: rotateY(180deg); }
        
        .envelope-front, .envelope-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .envelope-front {
            background: linear-gradient(135deg, #D32F2F 0%, #B71C1C 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px solid #FFD700;
        }
        .envelope-decoration {
            width: 80px; height: 80px; border-radius: 50%; background: #FFD700;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: 900; color: #B71C1C; margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 4px solid #FFF8E1; font-family: var(--title-font);
        }
        
        .envelope-back {
            background: #FFF8E1; transform: rotateY(180deg);
            display: flex; align-items: center; justify-content: center; padding: 20px;
            border: 8px solid #B71C1C;
        }
        
        .verse-card {
            width: 100%; height: 100%; background: white; border-radius: 8px;
            display: flex; flex-direction: column; text-align: center;
            padding: 20px 15px; border: 1px solid #FFECB3;
            background-image: radial-gradient(#FFF8E1 1px, transparent 1px); background-size: 20px 20px;
        }

        /* Fruit Game Styles */
        .fruit-item {
            position: absolute; width: 72px; height: 72px; border-radius: 50%;
            display: flex; flex-direction: column; /* Stack icon and text */
            align-items: center; justify-content: center;
            font-size: 16px; cursor: pointer; 
            /* PERFORMANCE FIX: Remove box-shadow during animation to prevent lag */
            /* box-shadow: 0 4px 8px rgba(0,0,0,0.2); */
            border: 2px solid rgba(255,255,255,0.8);
            animation: fall linear forwards;
            z-index: 50; user-select: none;
            -webkit-tap-highlight-color: transparent;
            top: 0; 
            /* PERFORMANCE FIX: Hint browser to optimize for transform */
            will-change: transform;
            transform: translateZ(0);
        }
        .fruit-item:active { transform: scale(0.9); }
        .fruit-pop { animation: pop 0.3s ease-out forwards; }
        
        @keyframes fall { 
            0% { transform: translateY(-100px); } 
            100% { transform: translateY(120vh); } 
        }
        
        @keyframes pop { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(1.5); opacity: 0; } }
        
        .game-header {
            background: rgba(255, 255, 255, 0.9); border-radius: 16px; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border: 2px solid #FFAB91; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 10px; width: 100%; max-width: 400px;
        }

        /* Memory Game Styles */
        .flip-card {
            background-color: transparent;
            perspective: 1000px;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            /* 1. ç¢ºä¿å¡ç‰‡æœ‰å¯¬åº¦ï¼Œä¸¦ä½”æ»¿ Grid æ ¼å­ */
            width: 100%;
            /* 2. é‡ç½®é«˜åº¦ï¼Œæ”¹ç”¨ Padding-bottom æ’é–‹é«˜åº¦ (Aspect Ratio Fallback) */
            height: 0;
            padding-bottom: 133.33%; /* 3:4 æ¯”ä¾‹ => 4/3 * 100% = 133.33% */
            position: relative; /* è®“å…§å±¤çµ•å°å®šä½åƒè€ƒæ­¤å®¹å™¨ */
        }
        .flip-card-inner {
            /* 3. ä½¿ç”¨çµ•å°å®šä½å¡«æ»¿è¢« Padding æ’é–‹çš„ç©ºé–“ */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .flip-card-front {
            background: linear-gradient(135deg, #FFCCBC 0%, #D84315 100%);
            color: white;
            font-size: 24px;
            border: 2px solid #fff;
        }
        .flip-card-back {
            background-color: #FFF3E0;
            color: #D84315;
            transform: rotateY(180deg);
            border: 2px solid #FFAB91;
            font-weight: bold;
            font-family: var(--title-font);
            padding: 4px;
            font-size: 14px;
            line-height: 1.2;
        }
        .flip-card-back.matched {
            background-color: #E8F5E9;
            color: #2E7D32;
            border-color: #A5D6A7;
        }
        
        /* Solitaire Game Styles */
        .solitaire-board {
            display: flex;
            justify-content: space-around;
            width: 100%;
            flex-grow: 1; /* Occupy remaining space */
            perspective: 1000px;
        }
        .sol-col {
            width: 23%;
            height: 100%;
            position: relative;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border: 1px dashed rgba(255,255,255,0.3);
            /* Allows cards to stack visually */
        }
        .sol-col.completed {
            border: 2px solid #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }
        /* Completed overlay text */
        .sol-col.completed::after {
            content: 'âœ… å®Œæˆ';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #FFD700;
            font-weight: 900;
            font-size: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 500;
        }

        .sol-card {
            position: absolute;
            width: 100%;
            aspect-ratio: 2/3;
            background: white;
            border-radius: 6px;
            border: 2px solid #ccc;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: top 0.2s, transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-align: center;
            user-select: none;
            font-size: 12px;
        }
        .sol-card-holding {
            position: relative;
            width: 28%;
            aspect-ratio: 2/3;
            flex-shrink: 0;
        }
        .sol-card.selected {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 0 15px #FFD700;
            border-color: #FFD700;
            z-index: 100 !important;
        }
        
        .sol-card-red { border-color: #EF5350; color: #B71C1C; background: #FFEBEE; }
        .sol-card-blue { border-color: #42A5F5; color: #0D47A1; background: #E3F2FD; }
        .sol-card-green { border-color: #66BB6A; color: #1B5E20; background: #E8F5E9; }
        .sol-card-gold { border-color: #FFA726; color: #E65100; background: #FFF3E0; }
        .sol-card-joker { border-color: #7B1FA2; color: white; background: linear-gradient(135deg, #BA68C8, #7B1FA2); font-weight: bold; }
        .sol-card-resurrection { border-color: #FFD700; color: #5D4037; background: linear-gradient(135deg, #FFF8E1, #FFECB3); font-weight: bold; }
        
        .sol-number { font-size: 16px; font-weight: 900; margin-bottom: 2px; }
        .sol-text { 
            font-size: 9px; 
            line-height: 1.2; 
            white-space: pre-wrap; 
            word-break: break-word;
        }

        /* Quiz Review List Styles */
        #quiz-review-list {
            margin-top: 20px;
            text-align: left;
            border-top: 2px dashed #e2e8f0;
            padding-top: 15px;
        }
        .quiz-review-item {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #e2e8f0;
            font-size: 14px;
        }
        .quiz-review-q {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
        }
        .quiz-review-ans {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        .ans-label {
            color: #64748b;
            margin-right: 4px;
        }
        .ans-text.correct {
            color: #16a34a;
            font-weight: bold;
        }
        .ans-text.wrong {
            color: #dc2626;
            font-weight: bold;
            text-decoration: line-through;
        }
    </style>
</head>
<body>

    <!-- App Root Container -->
    <div id="bg-layer">
        <div class="streamlines"></div>
        <div id="stars-container" class="stars-container"></div>
        <div class="waves-container">
            <div class="wave wave-green"></div>
            <div class="wave wave-gold"></div>
        </div>
    </div>

    <!-- App Root: è² è²¬å…§å®¹ä½ˆå±€èˆ‡å¯¬åº¦é™åˆ¶ -->
    <div id="app-root">
        
        <!-- Lanterns -->
        <div class="lantern-container">
            <div class="lantern l-left"><div class="lantern-text">ç¦</div></div>
            <div class="lantern l-right"><div class="lantern-text">æ˜¥</div></div>
        </div>

        <!-- Inner Nav Bar -->
        <div id="inner-nav-bar">
            <div class="nav-back-btn" onclick="showHome()">
                <i class="fas fa-chevron-left"></i> å›å¤§å»³
            </div>
            <div class="nav-title">Jesus Vibes 2026</div>
        </div>

        <!-- Scroll Wrapper -->
        <div id="scroll-wrapper">
            <!-- Main Content -->
            <div class="app-container">
                  
                <!-- Home Header -->
                <header id="home-header" onclick="showHome()">
                    <div class="flex justify-center items-center gap-4 mb-3 opacity-80 header-icon-group">
                        <i class="fas fa-cross text-xl text-yellow-200 drop-shadow-md"></i>
                        <span class="text-yellow-200 text-opacity-80 text-xs tracking-[0.4em] font-serif">EMMANUEL</span>
                        <i class="fas fa-fish text-xl text-yellow-200 drop-shadow-md"></i>
                    </div>
                    <h1 class="text-4xl font-black text-white mb-2 drop-shadow-lg" style="text-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                        Jesus Vibes <span class="title-font ml-1 text-yellow-300">2026</span>
                    </h1>
                    <p class="text-yellow-100/90 text-sm font-bold tracking-[0.2em] title-font drop-shadow-md mt-2 border-t border-b border-yellow-200/30 py-2 inline-block px-4">æ©Ÿæ™ºçš„éå¹´ç”Ÿæ´»</p>
                </header>

                <!-- Home Menu (2x2 Grid) -->
                <div id="home-menu" class="w-full">
                    <div class="menu-grid">
                        <!-- 1. Red Envelope -->
                        <div onclick="showScratch()" class="menu-btn group">
                            <div class="icon-bg bg-ny-red"><i class="fas fa-envelope-open-text"></i></div>
                            <h2 class="text-lg font-bold text-red-800 title-font">æ©å…¸ç´…åŒ…</h2>
                            <span class="text-xs text-red-400 font-bold mt-2 uppercase tracking-wide">Daily Blessing</span>
                        </div>
                        <!-- 2. Prayer -->
                        <div onclick="showPrayer()" class="menu-btn group">
                            <div class="icon-bg" style="background: linear-gradient(135deg, #3F5846 0%, #2F4234 100%); color: #E6B450; border: 1px solid #D4AF37;"><i class="fas fa-book-bible"></i></div>
                            <h2 class="text-lg font-bold text-[#2F4234] title-font">ç¦±å‘Šå°æ™‚å…‰</h2>
                            <span class="text-xs text-[#4A6351] font-bold mt-2 uppercase tracking-wide">Prayer Time</span>
                        </div>
                        <!-- 3. Tree Hole -->
                        <div onclick="showTalk()" class="menu-btn group">
                            <div class="icon-bg bg-ny-green"><i class="fas fa-hand-pointer"></i></div>
                            <h2 class="text-lg font-bold text-green-800 title-font">å°ˆæ²»å¿ƒç´¯æˆ³æˆ³æ¨‚</h2>
                            <span class="text-xs text-green-600 font-bold mt-2 uppercase tracking-wide">Soul Healing</span>
                        </div>
                        <!-- 4. Survival Hub -->
                        <div onclick="showSurvivalHub()" class="menu-btn group">
                            <div class="icon-bg bg-ny-purple"><i class="fas fa-brain"></i></div>
                            <h2 class="text-lg font-bold text-[#4A148C] title-font">éå¹´æ±‚ç”ŸåŒ…</h2>
                            <span class="text-xs text-[#7B1FA2] font-bold mt-2 uppercase tracking-wide">Wise Life in CNY</span>
                            <div class="absolute top-3 right-3 text-[#7B1FA2] opacity-0 group-active:opacity-100 transition-opacity">
                                <i class="fas fa-comment-dots"></i>
                            </div>
                        </div>
                        
                        <!-- 5. Scholar Hub (Modified Color to C100 Blue) -->
                        <div onclick="showScholarHub()" class="menu-btn group">
                            <div class="icon-bg" style="background: #00AEEF; color: #FFFFFF; border: 2px solid #0090C5;"><i class="fas fa-graduation-cap"></i></div>
                            <h2 class="text-lg font-bold text-[#007EA7] title-font">å¤©åœ‹å­¸éœ¸é¤Šæˆç­</h2>
                            <span class="text-xs text-[#00AEEF] font-bold mt-2 uppercase tracking-wide">Bible Scholar</span>
                        </div>

                        <!-- 6. Game Hub (Modified Color to Deep Orange Red) -->
                        <div onclick="showGameHub()" class="menu-btn group">
                            <div class="icon-bg" style="background: #FBE9E7; color: #D84315; border: 2px solid #FFAB91;"><i class="fas fa-gamepad"></i></div>
                            <h2 class="text-lg font-bold text-[#BF360C] title-font">æ‰‹æŒ‡å¾©å¥å°å­¸å ‚</h2>
                            <span class="text-xs text-[#D84315] font-bold mt-2 uppercase tracking-wide">Mini Games</span>
                        </div>
                    </div>
                </div>

                <!-- 1. Scratch View -->
                <div id="scratch-view" class="hidden view-container">
                    <section id="card-scratch" class="ny-card p-6 text-center">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-red-700 rounded-full border-4 border-[#E6B450] flex items-center justify-center text-white shadow-xl text-xl">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="mt-6 mb-5">
                            <h2 class="text-2xl font-bold title-font text-red-800">åˆ®é–‹ç¥ç¦</h2>
                        </div>
                        <div class="scratch-wrapper bg-red-50 p-3 rounded-2xl shadow-inner border border-red-100 mb-2">
                            <div class="scratch-box" id="scratchCard">
                                <div class="scratch-text absolute top-0 left-0 w-full h-full flex items-center justify-center p-6 z-0 bg-[#FFFEFA]">
                                    <span id="verseText" class="font-bold text-red-900 text-lg leading-loose title-font">Loading...</span>
                                </div>
                                <canvas id="scratchCanvas" class="absolute top-0 left-0 z-10 w-full h-full cursor-crosshair touch-none"></canvas>
                            </div>
                        </div>
                        
                        <div class="mb-5">
                            <button id="fullVerseBtn" onclick="showFullVerse()" class="text-xs font-bold text-red-400 border border-red-200 rounded-full px-4 py-1 hover:bg-red-50 transition-colors hidden">
                                <i class="fas fa-book-open mr-1"></i> é¡¯ç¤ºå®Œæ•´ç¶“æ–‡
                            </button>
                        </div>

                        <div class="action-group">
                            <button onclick="resetScratchCard()" class="forest-btn btn-green"><i class="fas fa-sync-alt"></i> å†æŠ½ä¸€å¼µ</button>
                            <button onclick="shareVerse()" class="forest-btn btn-gold"><i class="fas fa-share-alt"></i> åˆ†äº«ç¥ç¦</button>
                        </div>
                    </section>
                </div>

                <!-- 2. Poke View -->
                <div id="talk-view" class="hidden view-container">
                    <section id="card-talk" class="ny-card p-6 text-center" style="min-height: 600px;">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-green-700 rounded-full border-4 border-[#E6B450] flex items-center justify-center text-white shadow-xl text-xl">
                            <i class="fas fa-hand-pointer"></i>
                        </div>
                        <div class="mt-6 mb-4">
                            <h2 class="text-2xl font-bold text-green-800 title-font">å°ˆæ²»å¿ƒç´¯æˆ³æˆ³æ¨‚</h2>
                            <p class="text-green-600 text-xs mt-1 font-bold">è¦ªæˆšæ”»å‹¢å¤ªçŒ›çƒˆï¼Ÿæˆ³ä¸€ä¸‹ï¼Œå¤©çˆ¶å¹«ä½ è£œè£œè¡€</p>
                        </div>

                        <div id="pokeGrid" class="grid grid-cols-3 gap-3 w-full max-w-[320px] mx-auto mb-4 bg-[#6e4837] p-3 rounded-lg border-4 border-[#8B4513] shadow-lg"></div>
                        
                        <button id="resetPokeBtn" onclick="initPokeGame()" class="hidden text-xs font-bold text-green-600 border border-green-300 rounded-full px-4 py-2 hover:bg-green-50 transition-colors mx-auto mb-4">
                            <i class="fas fa-redo-alt mr-1"></i> æ›ä¸€ç›’ç©
                        </button>

                        <div id="responseArea" class="hidden bg-gradient-to-br from-green-50 to-white border-2 border-green-100 rounded-2xl p-6 text-left relative shadow-sm fade-in">
                            <div class="flex justify-between items-end mb-3 border-b border-green-100 pb-2">
                                <h3 id="responseTitle" class="text-xl font-bold text-green-800 title-font"></h3>
                                <span id="responseDate" class="text-xs text-gray-400 font-bold mb-1"></span>
                            </div>
                            <div class="mb-4 bg-white/60 p-3 rounded-lg border-l-4 border-green-300">
                                <div class="text-[10px] text-green-900 font-bold uppercase tracking-wider mb-1">éˆä¿®ç¶“æ–‡</div>
                                <p id="responseRef" class="text-green-900 font-bold text-sm"></p>
                            </div>
                            <div class="mb-5">
                                <p id="responseText" class="text-gray-900 text-lg leading-relaxed text-justify font-medium"></p>
                            </div>
                            <div class="bg-green-100/50 p-3 rounded-xl flex items-center gap-3 border border-green-200">
                                <div class="bg-green-200 w-10 h-10 rounded-full flex items-center justify-center text-green-700 flex-shrink-0">
                                    <i class="fas fa-music"></i>
                                </div>
                                <div class="overflow-hidden">
                                    <div class="text-[10px] text-green-600 font-bold uppercase">ä»Šæ—¥é»æ’­</div>
                                    <div id="responseSong" class="text-green-900 font-bold text-sm truncate"></div>
                                </div>
                            </div>
                            <div class="mt-5 border-t border-green-200 pt-3">
                                <button onclick="shareResponse()" class="share-btn-hide text-xs text-green-600 font-bold flex items-center justify-end w-full gap-2">åˆ†äº«é€™ä»½æ„Ÿå‹• <i class="fas fa-share-alt"></i></button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 3. Prayer View -->
                <div id="prayer-view" class="hidden view-container">
                    <section id="card-prayer" class="ny-card p-6 text-center" style="border-color: #E6B450; background: #3F5846;">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 rounded-full border-4 border-[#E6C888] flex items-center justify-center text-white shadow-xl text-xl" style="background: linear-gradient(135deg, #2F4234, #1B291F);">
                            <i class="fas fa-book-bible"></i>
                        </div>
                        <div class="mt-6 mb-5">
                            <h2 class="text-2xl font-bold text-[#E6B450] title-font">ç¦±å‘Šå°æ™‚å…‰</h2>
                            <p class="text-gray-200 text-xs mt-1 font-bold">ç¿»é–‹å±¬æ–¼ä½ çš„ç¦±å‘Šé é¢</p>
                        </div>
                        <div id="prayerBookContainer" class="relative mt-8 mb-8 perspective-1000">
                            <div id="bookCover" class="cursor-pointer transition-transform transform hover:scale-105 active:scale-95 duration-300" onclick="openPrayerBook()">
                                <div class="w-48 h-64 mx-auto rounded-r-lg rounded-l-sm shadow-2xl flex flex-col items-center justify-center text-[#F9FBE7] relative overflow-hidden group" style="background: linear-gradient(135deg, #5E1214 0%, #8E1E20 100%); border-left: 6px solid #3E0B0C;">
                                    <div class="absolute inset-0 border-2 border-[#E6C888]/40 m-3 rounded-r-md rounded-l-none"></div>
                                    <div class="absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-white/10 via-transparent to-transparent pointer-events-none"></div>
                                    <i class="fas fa-praying-hands text-4xl mb-4 opacity-90 group-hover:scale-110 transition-transform text-[#E6B450] drop-shadow-sm"></i>
                                    <span class="font-bold tracking-widest title-font text-lg text-[#E6B450] drop-shadow-md" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">ç¿»é–‹<br>ç¦±å‘Š</span>
                                </div>
                                <p class="text-[#E6B450] text-xs mt-6 font-bold animate-pulse"><i class="fas fa-hand-pointer mr-1"></i> é»æ“Šç¿»é–‹é ˜å—ç¥ç¦</p>
                            </div>
                            <div id="bookPage" class="hidden w-full bg-[#FFFEFA] rounded-lg shadow-xl border border-[#C5A059] p-6 text-left relative flex flex-col justify-center transition-all duration-300">
                                <div class="absolute left-0 top-0 bottom-0 w-6 bg-gradient-to-r from-[#E0E0E0]/50 via-transparent to-transparent rounded-l-lg pointer-events-none"></div>
                                <div class="pl-4 border-l border-[#F0E68C] h-full flex flex-col">
                                    <h3 id="prayerBookTitle" class="text-xl font-bold text-[#5D4037] mb-3 text-center title-font pt-2 leading-relaxed"></h3>
                                    <div class="mb-4 relative">
                                        <p id="prayerBookRef" class="text-sm font-bold text-[#8B6914] bg-[#FAFAF5] p-3 rounded-md border-l-4 border-[#D4AF37] italic leading-relaxed"></p>
                                    </div>
                                    <p id="prayerBookText" class="text-[#5D4037] leading-loose text-justify font-medium text-base mb-2"></p>
                                    <div id="prayerBookFullContent" class="hidden mt-3 pt-3 border-t border-[#E6C888] transition-all duration-500 ease-in-out">
                                        <p id="prayerBookFullText" class="text-[#5D4037] leading-loose text-justify font-medium text-base"></p>
                                    </div>
                                    <div class="mt-4 text-center">
                                        <button id="prayerToggleBtn" onclick="toggleFullPrayer()" class="text-xs font-bold text-[#8B6914] bg-[#FAFAF5] px-4 py-2 rounded-full border border-[#D4AF37] hover:bg-[#F0E68C] transition-colors shadow-sm">
                                            <i class="fas fa-book-open mr-1"></i> ğŸ“– é–±è®€å®Œæ•´ç¦±å‘Š
                                        </button>
                                    </div>
                                    <div class="mt-4 text-center">
                                        <span class="text-[#C5A059] text-xs opacity-80 font-serif tracking-widest">- AMEN -</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="prayerActionButtons" class="hidden fade-in mt-4">
                            <button onclick="openPrayerBook()" class="forest-btn mb-4 shadow-md" style="background: linear-gradient(to bottom, #E6B450, #C5A059); border-bottom-color: #8B6914; color: #3F5846;"><i class="fas fa-sync-alt"></i> å†ç¿»ä¸€é </button>
                            <button onclick="sharePrayerBook()" class="text-xs text-[#E6B450] font-bold w-full gap-2 hover:text-white transition-colors py-2">åˆ†äº«é€™ç¯‡ç¦±å‘Š <i class="fas fa-share-alt"></i></button>
                        </div>
                    </section>
                </div>

                <!-- 4.1. NEW: Survival HUB (The Selection Screen) -->
                <div id="survival-hub-view" class="hidden view-container">
                      <section class="ny-card p-6 text-center" style="border-color: #E1BEE7; background: rgba(253, 245, 255, 0.95);">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-[#6A1B9A] rounded-full border-4 border-[#E1BEE7] flex items-center justify-center text-white shadow-xl text-xl">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="mt-6 mb-6">
                            <h2 class="text-2xl font-bold text-[#4A148C] title-font">éå¹´æ±‚ç”ŸåŒ…</h2>
                            <p class="text-[#7B1FA2] text-xs mt-1 font-bold">è«‹é¸æ“‡æ‚¨éœ€è¦çš„è£å‚™</p>
                        </div>

                        <div class="space-y-4">
                            <!-- Option 1: Survival Guide (Renamed) -->
                            <div onclick="showSurvivalGuide()" class="bg-white p-5 rounded-2xl border-2 border-purple-200 shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-scroll"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-purple-900 text-lg mb-1">é•·è¼©æ‡‰å°ç¥•ç±</h3>
                                    <p class="text-xs text-gray-500 mb-2">éå¹´å¿…å‚™çš„è©±é¡Œç”Ÿå­˜æŒ‡å—</p>
                                    <div class="flex justify-start">
                                        <span id="hub-survival-status" class="text-[10px] bg-purple-50 text-purple-400 px-2 py-0.5 rounded-full border border-purple-100">è¼‰å…¥ä¸­...</span>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right ml-auto text-purple-300"></i>
                            </div>

                            <!-- Option 2: The NEW Bible First Aid Kit -->
                            <div onclick="showFirstAid()" class="bg-white p-5 rounded-2xl border-2 border-red-200 shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-medkit"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-red-900 text-lg mb-1">è–ç¶“æ€¥æ•‘ç®±</h3>
                                    <p class="text-xs text-gray-500 mb-2">é‡å°æƒ…ç·’èˆ‡ç‹€æ…‹çš„å±¬å¤©è™•æ–¹ç±¤</p>
                                    <div class="flex justify-start">
                                        <span id="hub-firstaid-status" class="text-[10px] bg-red-50 text-red-400 px-2 py-0.5 rounded-full border border-red-100">è¼‰å…¥ä¸­...</span>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right ml-auto text-red-300"></i>
                            </div>
                        </div>
                      </section>
                </div>

                <!-- 4.2. Survival Guide (Modified) -->
                <div id="survival-view" class="hidden view-container">
                    <section id="card-survival" class="ny-card p-6 text-center" style="border-color: #E1BEE7; background: rgba(253, 245, 255, 0.95);">
                        <!-- Back to Hub Button -->
                         <div class="text-left mb-2 -mt-2">
                            <button onclick="showSurvivalHub()" class="text-xs font-bold text-[#6A1B9A] bg-purple-100 px-3 py-1 rounded-full"><i class="fas fa-arrow-left"></i> è¿”å›é¸å–®</button>
                        </div>

                        <div class="mt-2 mb-2 flex items-center justify-center gap-2">
                            <h2 class="text-xl font-bold text-[#4A148C] title-font">é•·è¼©æ‡‰å°ç¥•ç±</h2>
                        </div>
                        
                        <!-- Status Display -->
                        <div class="text-[10px] text-purple-400 mb-4 font-bold tracking-wider">
                            <i class="fas fa-book-reader mr-1"></i> <span id="survival-count-display">ç¥•ç±é æ•¸ï¼š0</span>
                        </div>

                        <!-- Disclaimer / Intro -->
                        <div id="survival-intro" class="mt-2">
                            <div class="bg-purple-50 p-6 rounded-2xl border-2 border-purple-100 mb-6">
                                <i class="fas fa-robot text-4xl text-purple-300 mb-3"></i>
                                <h3 class="font-bold text-purple-900 text-lg mb-2">ä½¿ç”¨å‰è«‹è©³é–±å…¬é–‹èªªæ˜æ›¸</h3>
                                <p class="text-purple-800 text-sm leading-relaxed font-medium">
                                    æœ¬å€å…§å®¹ç”± AI ç”Ÿæˆï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒã€‚<br>
                                    è‹¥æœ‰ç¥å›è¦†è«‹ç¬‘ç´ï¼Œè‹¥ä¸åˆé©ç¬‘ç¬‘å°±å¥½ã€‚<br>
                                    <span class="block mt-2 font-bold text-purple-600">éå¹´æ±‚ç”Ÿï¼Œé–‹å¿ƒè‡³ä¸Šï¼Œå‹¿å¤ªèªçœŸï¼ğŸ§§</span>
                                </p>
                            </div>
                            <button onclick="startSurvival()" class="forest-btn btn-purple shadow-lg w-full">
                                <i class="fas fa-check-circle"></i> æˆ‘æº–å‚™å¥½äº†
                            </button>
                        </div>

                        <!-- Main Content -->
                        <div id="survival-content" class="hidden space-y-4">
                            <div class="style-options">
                                <div class="style-pill active" onclick="selectStyle(this, 'toxic')" data-style="toxic">ğŸ çŠ€åˆ©é¢¨</div>
                                <div class="style-pill" onclick="selectStyle(this, 'funny')" data-style="funny">ğŸ¤£ å¹½é»˜é¢¨</div>
                                <div class="style-pill" onclick="selectStyle(this, 'pun')" data-style="pun">âš”ï¸ ä¿ å®¢é¢¨</div>
                                <div class="style-pill" onclick="selectStyle(this, 'gentle')" data-style="gentle">ğŸ•Šï¸ æº«æŸ”é¢¨</div>
                                <div class="style-pill" onclick="selectStyle(this, 'drama')" data-style="drama">ğŸ­ å…«é»æª”é¢¨</div>
                                <div class="style-pill" onclick="selectStyle(this, 'ancient')" data-style="ancient">ğŸ“œ å¤å¶é¢¨</div>
                            </div>
                            <div class="relative text-left mt-2" id="survival-input-container">
                                <textarea id="survivalInput" rows="2" placeholder="è«‹è¼¸å…¥å•é¡Œã€Œé—œéµå­—ã€ (ä¾‹å¦‚ï¼šçµå©šã€è–ªæ°´)ï¼Œå­—æ•¸ç²¾ç°¡æ›´æº–ç¢ºï¼" class="story-input text-gray-700 placeholder-purple-300/70" style="border-color: #E1BEE7;"></textarea>
                            </div>
                            <button onclick="getSurvivalResponse()" class="forest-btn btn-purple w-full shadow-lg shadow-purple-900/10"><i class="fas fa-shield-alt"></i> ç”Ÿæˆç¥å›è¦†</button>
                            <div id="survivalResponseArea" class="hidden mt-6 bg-gradient-to-br from-purple-50 to-white border-2 border-purple-100 rounded-2xl p-6 text-left relative shadow-sm">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="text-[#6A1B9A] text-xs font-bold title-font flex items-center"><i class="fas fa-comment-dots mr-2 bg-purple-100 p-1.5 rounded-full"></i> å»ºè­°å›è¦†ï¼š</h3>
                                    <span id="styleBadge" class="text-[10px] px-2 py-1 rounded bg-purple-200 text-purple-800 font-bold">æ¯’èˆŒç‰ˆ</span>
                                </div>
                                <p id="survivalText" class="text-[#4A148C] font-bold text-lg leading-relaxed mb-3"></p>
                                <div class="mt-4 border-t border-purple-200 pt-3">
                                    <button onclick="shareSurvival()" class="text-xs text-[#6A1B9A] font-bold hover:text-purple-700 flex items-center justify-end w-full gap-2 py-1">
                                    è¤‡è£½é€™å¥å»æˆ°é¬¥ <i class="fas fa-copy bg-purple-100 p-1.5 rounded-full"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 4.3. Bible First Aid Kit View -->
                <div id="first-aid-view" class="hidden view-container">
                      <section class="ny-card p-4 text-center" style="border-color: #FECACA; background: #FFFEFA;">
                        <!-- Back to Hub Button -->
                         <div class="text-left mb-2 -mt-2 flex justify-between items-center">
                            <button onclick="showSurvivalHub()" class="text-xs font-bold text-red-600 bg-red-50 px-3 py-1 rounded-full"><i class="fas fa-arrow-left"></i> è¿”å›é¸å–®</button>
                            <!-- Stock Status -->
                            <span class="text-[10px] text-red-400 font-bold tracking-wider"><i class="fas fa-pills mr-1"></i> <span id="first-aid-count-display">è—¥å±€åº«å­˜ï¼š0</span></span>
                        </div>

                        <!-- User's Module Content Starts Here -->
                        <div id="first-aid-app" class="w-full">
                            <!-- 1. æ€¥æ•‘ç®±äº’å‹•å€ -->
                            <div id="categoriesContainer" class="mb-6">
                                <h4 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider flex items-center justify-center gap-2">
                                    <i class="fas fa-medkit text-[#E6B450]"></i> ä½ çš„å°ˆå±¬æ€¥æ•‘ç®±
                                </h4>
                                
                                <!-- ç‹€æ…‹ 1: é—œé–‰çš„ç®±å­ -->
                                <div id="firstAidKitClosed" class="w-full flex flex-col items-center justify-center py-6 cursor-pointer group transition-transform active:scale-95" onclick="openFirstAidKit()">
                                    <div class="relative w-36 h-28 bg-red-600 rounded-xl border-4 border-red-800 shadow-xl flex items-center justify-center">
                                        <div class="absolute -top-4 w-12 h-6 border-4 border-red-800 rounded-t-lg bg-red-700"></div>
                                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-red-600 text-3xl font-black shadow-sm">
                                            <i class="fas fa-plus"></i>
                                        </div>
                                    </div>
                                    <p class="mt-3 text-red-800 text-sm font-bold tracking-widest animate-pulse">é»æ“Šæ‰“é–‹æ€¥æ•‘ç®±</p>
                                </div>

                                <!-- ç‹€æ…‹ 2: æ‰“é–‹çš„ç®±å­ (è—¥ç½åˆ—è¡¨) -->
                                <div id="firstAidKitOpened" class="hidden w-full bg-gray-50 rounded-xl p-4 border-2 border-gray-200 shadow-inner">
                                    <div id="categoryList" class="grid grid-cols-2 gap-3">
                                        <div class="text-center w-full py-4 text-gray-400 text-xs col-span-2">
                                            <i class="fas fa-spinner fa-spin mr-2"></i> è—¥å±€è£œè²¨ä¸­...
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. æ€¥æ•‘ OK ç¹ƒ (ç†±é–€æ¨™ç±¤) -->
                            <div id="hotTagsContainer" class="mb-6">
                                <div class="flex justify-between items-center mb-3 px-1">
                                    <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider flex items-center gap-2">
                                        <i class="fas fa-band-aid text-[#E6B450] text-lg"></i> æ€¥æ•‘ OK ç¹ƒ
                                    </h4>
                                    <span class="text-[10px] text-gray-400 font-bold flex items-center animate-pulse">
                                        <i class="fas fa-hand-point-left mr-1"></i> å·¦æ»‘æ‰¾è§£æ–¹
                                    </span>
                                </div>
                                
                                <div class="relative -mx-4 group">
                                    <div id="hotTagsList" class="flex overflow-x-auto gap-3 px-4 pb-4 no-scrollbar scroll-smooth" style="-webkit-overflow-scrolling: touch;">
                                        <!-- JS å°‡è‡ªå‹•ç”¢ç”Ÿæ¨™ç±¤ -->
                                    </div>
                                    <!-- å³å´æ¼¸å±¤èˆ‡æç¤ºç®­é ­ -->
                                    <div class="absolute right-0 top-0 h-full w-16 bg-gradient-to-l from-white via-white/90 to-transparent pointer-events-none flex items-center justify-end pr-2 pb-4 z-10">
                                        <div onclick="event.stopPropagation(); document.getElementById('hotTagsList').scrollBy({left: 150, behavior: 'smooth'})" class="w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center text-[#E6B450] text-sm animate-bounce border border-orange-100 cursor-pointer pointer-events-auto hover:bg-gray-50 transition-transform">
                                            <i class="fas fa-chevron-right"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. æœå°‹çµæœåˆ—è¡¨ -->
                            <div id="searchResultsList" class="space-y-4 pb-4">
                                <!-- çµæœå°‡é¡¯ç¤ºæ–¼æ­¤ -->
                            </div>
                        </div>
                        <!-- Module Ends -->
                      </section>
                </div>

                <!-- 5. Scholar Hub View (Modified Color to C100 Blue) -->
                <div id="scholar-hub-view" class="hidden view-container">
                      <section class="ny-card p-6 text-center" style="border-color: #00AEEF; background: #E0F7FA;">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-[#00AEEF] rounded-full border-4 border-[#81D4FA] flex items-center justify-center text-white shadow-xl text-xl">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="mt-6 mb-6">
                            <h2 class="text-2xl font-bold text-[#006064] title-font">å¤©åœ‹å­¸éœ¸é¤Šæˆç­</h2>
                            <p class="text-[#0097A7] text-xs mt-1 font-bold">æ¸¬æ¸¬çœ‹ï¼Œä½ çš„å±¬éˆçŸ¥è­˜åº«æœ‰å¤šå°‘ï¼Ÿ</p>
                        </div>

                        <div class="space-y-4">
                            <!-- Quiz 1 -->
                            <div onclick="startQuiz('quiz1', 'è–ç¶“å¤§æœƒè€ƒ')" class="bg-white p-5 rounded-2xl border-2 border-[#81D4FA] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#E1F5FE] text-[#00AEEF] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-pencil-alt"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#006064] text-lg mb-1">è–ç¶“å¤§æœƒè€ƒ</h3>
                                    <p class="text-xs text-gray-500">é™æ™‚1åˆ†é˜ï¼çœ‹çœ‹ä½ èƒ½ç­”å°å¹¾é¡Œ</p>
                                </div>
                                <i class="fas fa-chevron-right ml-auto text-[#4DD0E1]"></i>
                            </div>

                            <!-- Quiz 2 -->
                            <div onclick="startQuiz('quiz3', 'é‡è¦‹å½Œè³½äº')" class="bg-white p-5 rounded-2xl border-2 border-[#81D4FA] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#E1F5FE] text-[#00AEEF] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-cross"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#006064] text-lg mb-1">é‡è¦‹å½Œè³½äº</h3>
                                    <p class="text-xs text-gray-500">é—œæ–¼è€¶ç©Œç”Ÿå¹³çš„æ·±åº¦æ¢ç´¢</p>
                                </div>
                                <i class="fas fa-chevron-right ml-auto text-[#4DD0E1]"></i>
                            </div>

                            <!-- Quiz 3 -->
                            <div onclick="startQuiz('quiz2', 'è–ç¶“å†·çŸ¥è­˜')" class="bg-white p-5 rounded-2xl border-2 border-[#81D4FA] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#E1F5FE] text-[#00AEEF] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-snowflake"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#006064] text-lg mb-1">è–ç¶“å†·çŸ¥è­˜</h3>
                                    <p class="text-xs text-gray-500">é‚£äº›ä½ å¯èƒ½æ²’æ³¨æ„åˆ°çš„æœ‰è¶£ç´°ç¯€</p>
                                </div>
                                <i class="fas fa-chevron-right ml-auto text-[#4DD0E1]"></i>
                            </div>
                        </div>

                        <!-- è­¦èª -->
                        <div class="mt-6 text-xs text-[#006064]/70 bg-[#E0F7FA]/50 p-4 rounded-xl border border-[#81D4FA]/30 leading-relaxed text-justify">
                            <i class="fas fa-info-circle mr-1"></i>
                            <span class="font-bold">æº«é¦¨æé†’ï¼š</span>æœ¬å–®å…ƒé¡Œç›®ç”± AI è¼”åŠ©ç”Ÿæˆï¼Œåƒ…ä¾›è¶£å‘³æ¸¬é©—åƒè€ƒã€‚æ­£ç¢ºè§£ç­”è«‹ä»¥ã€Šè–ç¶“ã€‹åŸæ–‡ç‚ºæº–ï¼Œè‹¥ç™¼ç¾å…§å®¹æœ‰èª¤ï¼Œæ­¡è¿ <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" class="underline font-bold hover:text-[#00AEEF]">åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿ</a> å‘ŠçŸ¥æˆ‘å€‘ï¼Œæ„Ÿè¬æ‚¨çš„å”åŠ©ï¼
                        </div>
                      </section>
                </div>

                <!-- NEW: Universal Quiz View -->
                <div id="quiz-view" class="hidden view-container">
                    <section class="ny-card p-6 text-center" style="border-color: #00AEEF; background: #FFFEFA; min-height: 500px;">
                        <div class="text-left mb-4 -mt-2 flex justify-between items-center">
                            <button onclick="showScholarHub()" class="text-xs font-bold text-[#00AEEF] bg-blue-50 px-3 py-1 rounded-full"><i class="fas fa-arrow-left"></i> æ”¾æ£„æ¸¬é©—</button>
                            <span id="quiz-progress" class="text-xs font-bold text-[#006064]">1 / 10</span>
                            <span id="quiz-timer" class="hidden text-xl font-black text-red-500">60</span>
                        </div>

                        <div id="quiz-content">
                            <div class="mb-2 text-left">
                                <span id="quiz-category-tag" class="text-[10px] bg-[#E1F5FE] text-[#0277BD] px-2 py-1 rounded-full font-bold tracking-wide">é¡åˆ¥</span>
                            </div>
                            <h3 id="quiz-question" class="text-xl font-bold text-[#006064] text-left leading-relaxed mb-6 font-serif">é¡Œç›®è¼‰å…¥ä¸­...</h3>
                            
                            <div id="quiz-options" class="space-y-3">
                                <!-- Options will be injected here -->
                            </div>

                            <div id="quiz-feedback" class="hidden mt-4 p-4 rounded-xl text-left bg-gray-50 border-2 border-gray-100">
                                <div class="flex items-center gap-2 mb-2">
                                    <div id="feedback-icon" class="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs"></div>
                                    <span id="feedback-title" class="font-bold text-sm"></span>
                                </div>
                                <!-- ä¿®æ”¹ï¼šå°‡ p æ”¹ç‚º div ä»¥æ”¯æ´ HTML å…§å®¹ -->
                                <div id="feedback-content" class="text-sm text-gray-600 leading-relaxed"></div>
                                <button onclick="nextQuestion()" id="next-q-btn" class="mt-4 w-full bg-[#00AEEF] text-white font-bold py-3 rounded-xl shadow-md active:scale-95 transition-transform">ä¸‹ä¸€é¡Œ</button>
                            </div>
                        </div>

                        <div id="quiz-result" class="hidden">
                            <div class="py-8">
                                <i class="fas fa-trophy text-6xl text-yellow-400 mb-4 block drop-shadow-md"></i>
                                <h3 class="text-2xl font-bold text-[#006064] mb-2">æ¸¬é©—å®Œæˆï¼</h3>
                                <p class="text-gray-500 text-sm mb-6">ä½ çš„å¤©åœ‹å­¸éœ¸æŒ‡æ•¸</p>
                                <div class="text-5xl font-black text-[#00AEEF] mb-6"><span id="final-score">0</span><span class="text-lg text-gray-400 ml-1">åˆ†</span></div>
                                
                                <!-- Quiz Review Area -->
                                <div id="quiz-review-list" class="hidden">
                                    <!-- Dynamic review items -->
                                </div>

                                <div class="grid grid-cols-2 gap-3 mt-6">
                                    <button onclick="showScholarHub()" class="py-3 rounded-xl font-bold text-[#00AEEF] bg-[#E1F5FE]">è¿”å›é¸å–®</button>
                                    <button onclick="restartQuiz()" class="py-3 rounded-xl font-bold text-white bg-[#00AEEF] shadow-lg">å†æ¸¬ä¸€æ¬¡</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 6. Game Hub View (Modified Color to Deep Orange Red) -->
                <div id="game-hub-view" class="hidden view-container">
                      <section class="ny-card p-6 text-center" style="border-color: #FF7043; background: #FBE9E7;">
                        <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-[#D84315] rounded-full border-4 border-[#FFAB91] flex items-center justify-center text-white shadow-xl text-xl">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <div class="mt-6 mb-6">
                            <h2 class="text-2xl font-bold text-[#BF360C] title-font">æ‰‹æŒ‡å¾©å¥å°å­¸å ‚</h2>
                            <p class="text-[#D84315] text-xs mt-1 font-bold">éå¹´æ»‘æ‰‹æ©Ÿï¼Œä¸å¦‚ä¾†ç·´ç·´æ‰‹æŒ‡éˆæ´»åº¦ï¼</p>
                        </div>

                        <div class="space-y-4">
                            <!-- Game 1 -->
                            <div onclick="startFruitGame()" class="bg-white p-5 rounded-2xl border-2 border-[#FFAB91] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#FFCCBC] text-[#D84315] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-apple-alt"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#BF360C] text-lg mb-1">è–éˆæœå­å¤§ä½œæˆ°</h3>
                                    <p class="text-xs text-gray-500">æ¥ä½å¾å¤©è€Œé™çš„å±¬éˆæœå­ (å°å¿ƒå£æœå­!)</p>
                                </div>
                                <i class="fas fa-play ml-auto text-[#FF8A65]"></i>
                            </div>

                            <!-- Game 2 -->
                            <div onclick="initMemoryGame()" class="bg-white p-5 rounded-2xl border-2 border-[#FFAB91] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#FFCCBC] text-[#D84315] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#BF360C] text-lg mb-1">è…¦åŠ›å…¨é–‹ç¿»ç¿»æ¨‚</h3>
                                    <p class="text-xs text-gray-500">è€ƒé©—è¨˜æ†¶åŠ›çš„ç¶“æ–‡é…å°</p>
                                </div>
                                <i class="fas fa-play ml-auto text-[#FF8A65]"></i>
                            </div>

                            <!-- Game 3: Solitaire -->
                            <div onclick="initMiracleSolitaire()" class="bg-white p-5 rounded-2xl border-2 border-[#FFAB91] shadow-md cursor-pointer hover:shadow-lg transition-all active:scale-95 flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-[#FFCCBC] text-[#D84315] flex items-center justify-center text-xl flex-shrink-0">
                                    <i class="fas fa-link"></i>
                                </div>
                                <div class="text-left w-full">
                                    <h3 class="font-bold text-[#BF360C] text-lg mb-1">ç¥è¹Ÿå¥‡äº‹é€£é€£çœ‹</h3>
                                    <p class="text-xs text-gray-500">è€¶ç©Œç¥è¹Ÿæ¥é¾æŒ‘æˆ° (å«å¾©æ´»ç‰Œ)</p>
                                </div>
                                <i class="fas fa-play ml-auto text-[#FF8A65]"></i>
                            </div>
                        </div>
                      </section>
                </div>

                <!-- NEW: Fruit Game View -->
                <div id="fruit-game-view" class="hidden view-container">
                    <section class="ny-card p-0 overflow-hidden relative" style="border-color: #FFAB91; background: #FFF3E0; height: 600px;">
                        <!-- Game Header -->
                        <div class="absolute top-0 left-0 w-full z-20 p-4 flex justify-between items-start pointer-events-none">
                            <button onclick="exitFruitGame()" class="pointer-events-auto w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center text-gray-500 text-sm">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="game-header pointer-events-auto">
                                <div class="flex flex-col items-center">
                                    <span class="text-[10px] text-gray-500 font-bold uppercase">æ™‚é–“</span>
                                    <span id="fruit-timer" class="text-2xl font-black text-[#D84315]">60</span>
                                </div>
                                <div class="w-px h-8 bg-gray-300 mx-4"></div>
                                <div class="flex flex-col items-center">
                                    <span class="text-[10px] text-gray-500 font-bold uppercase">ç›®æ¨™</span>
                                    <span class="text-lg font-bold text-[#BF360C]"><span id="fruit-score" class="text-2xl font-black">0</span>/20</span>
                                </div>
                            </div>
                        </div>

                        <!-- Game Area -->
                        <div id="fruit-game-area" class="w-full h-full relative overflow-hidden cursor-pointer">
                            <!-- Overlay: Start -->
                            <div id="fruit-start-overlay" class="absolute inset-0 bg-black/60 z-30 flex flex-col items-center justify-center text-white p-6 text-center">
                                <div class="w-20 h-20 bg-[#FFCCBC] rounded-full flex items-center justify-center text-4xl mb-4 animate-bounce text-[#D84315] border-4 border-white">
                                    <i class="fas fa-apple-alt"></i>
                                </div>
                                <h2 class="text-3xl font-bold mb-2 title-font text-[#FFAB91]">è–éˆæœå­å¤§ä½œæˆ°</h2>
                                <p class="text-sm opacity-90 mb-6 leading-relaxed">
                                    åœ¨ 60 ç§’å…§æ”¶é›† 20 é¡†è–éˆæœå­ï¼<br>
                                    <span class="text-yellow-300 font-bold">å°å¿ƒï¼</span> é»åˆ°å£æœå­æœƒæ‰£ 5 ç§’å–”ï¼
                                </p>
                                <button onclick="startGameLoop()" class="bg-[#D84315] text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg hover:scale-105 transition-transform">
                                    <i class="fas fa-play mr-2"></i> é–‹å§‹æŒ‘æˆ°
                                </button>
                            </div>

                            <!-- Overlay: Game Over (Time's Up) -->
                            <div id="fruit-gameover-overlay" class="hidden absolute inset-0 bg-black/80 z-30 flex flex-col items-center justify-center text-white p-6 text-center">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </section>
                </div>

                <!-- NEW: Memory Game View -->
                <div id="memory-game-view" class="hidden view-container">
                    <section class="ny-card p-0 overflow-hidden relative" style="border-color: #FFAB91; background: #FFF3E0; height: 100%;">
                        <div class="absolute top-0 left-0 w-full z-20 p-4 flex justify-between items-start pointer-events-none">
                            <button onclick="exitMemoryGame()" class="pointer-events-auto w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center text-gray-500 text-sm">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="game-header pointer-events-auto">
                                <div class="flex flex-col items-center">
                                    <span class="text-[10px] text-gray-500 font-bold uppercase">é—œå¡</span>
                                    <span id="memory-level-display" class="text-xl font-black text-[#D84315]">1/3</span>
                                </div>
                                <div class="w-px h-8 bg-gray-300 mx-4"></div>
                                <div class="flex flex-col items-center">
                                    <span class="text-[10px] text-gray-500 font-bold uppercase">æ™‚é–“</span>
                                    <span id="memory-timer" class="text-2xl font-black text-[#BF360C]">30</span>
                                </div>
                            </div>
                        </div>

                        <!-- Game Grid Container -->
                        <!-- ä¿®æ”¹ï¼šå°‡ pt-20 æ”¹ç‚º pt-32ï¼Œå¢åŠ é ‚éƒ¨ç©ºé–“ï¼Œé¿å…æ¨™é¡Œæ“‹ä½ç¬¬ä¸€æ’å¡ç‰‡ -->
                        <div class="w-full h-full pt-32 pb-4 px-4 overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
                            <div id="memory-game-grid" class="grid gap-2 w-full max-w-md mx-auto">
                                <!-- Cards will be injected here -->
                            </div>
                        </div>

                        <!-- Overlays -->
                        <div id="memory-overlay" class="absolute inset-0 bg-black/80 z-30 flex flex-col items-center justify-center text-white p-6 text-center hidden">
                            <div id="memory-overlay-content">
                                <!-- Dynamic Content -->
                            </div>
                        </div>
                    </section>
                </div>

                <!-- NEW: Solitaire Game View -->
                <div id="solitaire-game-view" class="hidden view-container">
                    <!-- ä¿®æ”¹ï¼šå°‡ height: 100% æ”¹ç‚º min-height: 600px; height: 80vh; ç¢ºä¿åœ¨ä»»ä½•è£ç½®ä¸Šéƒ½æœ‰é«˜åº¦ -->
                    <section class="ny-card p-0 overflow-hidden relative" style="border-color: #FFAB91; background: #4E342E; min-height: 600px; height: 80vh;">
                        <div class="absolute top-0 left-0 w-full z-20 p-4 flex justify-between items-start pointer-events-none">
                            <button onclick="exitMiracleSolitaire()" class="pointer-events-auto w-8 h-8 rounded-full bg-white shadow-md flex items-center justify-center text-gray-500 text-sm">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="game-header pointer-events-auto" style="background: rgba(255,255,255,0.95); width: auto;">
                                <span class="text-sm font-bold text-[#D84315]">ç¥è¹Ÿå¥‡äº‹é€£é€£çœ‹</span>
                            </div>
                        </div>

                        <!-- Solitaire Board (Flex Layout Fix) -->
                        <div class="w-full h-full pt-16 pb-4 flex flex-col justify-between">
                            <!-- Board Area -->
                            <div id="solitaire-board" class="flex-1 w-full px-2 flex justify-around relative">
                                <!-- Generated by JS -->
                            </div>
                            
                            <!-- Controls Area (Fixed height) -->
                            <div class="h-32 w-full px-4 flex items-end justify-between shrink-0 z-20">
                                <!-- Deck Counter -->
                                <div id="sol-deck" onclick="dealSolitaireCards()" class="w-20 h-28 bg-red-800 border-2 border-yellow-400 rounded-lg shadow-xl cursor-pointer flex flex-col items-center justify-center relative">
                                     <div class="absolute -top-3 bg-yellow-400 text-red-900 text-xs font-bold px-2 py-1 rounded-full border border-red-900">ç™¼ç‰Œ</div>
                                     <i class="fas fa-layer-group text-2xl text-yellow-400 mb-1"></i>
                                     <div id="sol-deck-count" class="text-white text-xs font-bold">50</div>
                                </div>
                                
                                <!-- Holding Area -->
                                <div id="sol-holding" class="flex-1 ml-4 flex gap-2 h-28 items-end justify-start overflow-visible">
                                    <!-- Dynamic Cards -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Message Toast -->
                        <div id="solitaire-message" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-sm font-bold bg-black/70 px-4 py-2 rounded-full hidden pointer-events-none z-50">
                            æç¤ºè¨Šæ¯
                        </div>

                        <!-- Start Overlay -->
                        <div id="solitaire-start-overlay" class="absolute inset-0 bg-black/85 z-50 flex flex-col items-center justify-center text-white p-8 text-center">
                            <h2 class="text-3xl font-bold mb-4 text-[#FFAB91]">ç¥è¹Ÿå¥‡äº‹é€£é€£çœ‹</h2>
                            <div class="text-left text-sm opacity-90 mb-6 space-y-2 bg-white/10 p-4 rounded-xl border border-white/20">
                                <p>ğŸ”¹ <span class="text-yellow-400 font-bold">æ’åˆ—è¦å‰‡</span>ï¼šå°‡ç‰Œç”±å°åˆ°å¤§æ’åˆ— (1â†’12)ã€‚</p>
                                <p>ğŸ”¹ <span class="text-yellow-400 font-bold">æ¶ˆé™¤</span>ï¼šé›†é½ŠåŒä¸€é¡è‰² 1-12 å³å¯æ¶ˆé™¤ã€‚</p>
                                <p>ğŸ”¹ <span class="text-yellow-400 font-bold">ğŸ‘‘å¾©æ´»ç‰Œ</span>ï¼šæ‹–æ›³è‡³æŸåˆ—ï¼Œè©²åˆ—ç›´æ¥å®Œæˆï¼(éœ€è‡³å°‘æœ‰ä¸€å¼µç‰Œ)</p>
                                <p>ğŸ”¹ <span class="text-yellow-400 font-bold">ğŸ‘»é¬¼ç‰Œ</span>ï¼šå°å¿ƒï¼æ”¾å…¥æŸåˆ—æœƒç‚¸é£›æ‰€æœ‰ç‰Œï¼</p>
                                <p>ğŸ”¹ <span class="text-yellow-400 font-bold">ç™¼ç‰Œ</span>ï¼šé»æ“Šå·¦ä¸‹è§’ç‰Œåº«ï¼Œéš¨æ©Ÿç™¼ä¸‰å¼µã€‚</p>
                            </div>
                            <button onclick="startSolitaireGame()" class="bg-[#D84315] text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg hover:scale-105 transition-transform cursor-pointer pointer-events-auto">
                                <i class="fas fa-play mr-2"></i> é–‹å§‹æ¥é¾
                            </button>
                        </div>
                    </section>
                </div>

                <!-- NEW: Heavenly Red Envelope View -->
                <div id="heavenly-envelope-view" class="hidden view-container">
                    <div class="w-full h-full flex flex-col items-center pt-10">
                        <div class="mb-4 text-center">
                            <h2 class="text-3xl font-bold text-[#FFD700] title-font drop-shadow-md">æ­å–œéé—œï¼</h2>
                            <p class="text-white text-sm mt-1 opacity-90">å¤©çˆ¶ç‚ºä½ é å‚™äº†ä¸€å€‹å¤§ç´…åŒ…</p>
                        </div>
                        
                        <div class="red-envelope-container" onclick="openRedEnvelope()">
                            <div class="red-envelope" id="redEnvelopeCard">
                                <!-- Front -->
                                <div class="envelope-front">
                                    <div class="envelope-decoration">ç¦</div>
                                    <div class="text-[#FFD700] font-bold text-xl tracking-widest title-font mt-2 border-t border-b border-[#FFD700] py-1 px-4">å¤©åœ‹å¤§ç´…åŒ…</div>
                                    <p class="text-[#FFCCBC] text-xs mt-4 animate-pulse">é»æ“Šé–‹å•Ÿç¥ç¦</p>
                                </div>
                                <!-- Back (Card) -->
                                <div class="envelope-back">
                                    <div class="verse-card" id="verseCardContent">
                                        <div class="mb-2">
                                            <span id="env-category" class="text-[10px] bg-[#B71C1C] text-white px-2 py-1 rounded-full font-bold tracking-wide">æ©å…¸</span>
                                        </div>
                                        <div class="flex-1 flex flex-col justify-center overflow-y-auto no-scrollbar">
                                            <h3 id="env-chinese" class="text-xl font-bold text-[#B71C1C] leading-relaxed mb-3 font-serif">è¼‰å…¥ä¸­...</h3>
                                            <p id="env-english" class="text-xs text-gray-500 italic leading-relaxed mb-2 font-serif whitespace-pre-wrap break-words"></p>
                                        </div>
                                        <div class="mt-auto pt-3 border-t border-[#FFECB3]">
                                            <p id="env-ref" class="text-sm font-bold text-[#F57F17]"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="envelope-actions" class="hidden mt-6 w-full px-10 flex gap-3 fade-in">
                            <button onclick="showGameHub()" class="forest-btn btn-blue shadow-lg"><i class="fas fa-gamepad"></i> å›éŠæˆ²</button>
                            <button onclick="shareEnvelope()" class="forest-btn btn-gold shadow-lg"><i class="fas fa-share-alt"></i> åˆ†äº«</button>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer>
                    <div class="flex justify-center mb-5">
                        <a href="https://www.facebook.com/profile.php?id=100068500932557" target="_blank" class="social-link">
                            <i class="fab fa-facebook-f text-lg"></i>
                        </a>
                        <a href="https://www.instagram.com/forever.believe.in.jesus/" target="_blank" class="social-link">
                            <i class="fab fa-instagram text-xl"></i>
                        </a>
                        <a href="https://www.threads.net/@forever.believe.in.jesus" target="_blank" class="social-link">
                            <i class="fab fa-threads text-lg"></i>
                        </a>
                    </div>

                    <!-- å®˜æ–¹ LINE é€£çµ -->
                    <div class="mb-3">
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" class="inline-flex items-center gap-2 px-5 py-2 bg-[#8E1E20] text-[#E6B450] rounded-full text-sm font-bold shadow-lg hover:bg-[#A63437] transition-transform active:scale-95 border border-[#E6B450]/50">
                            <i class="fab fa-line text-xl"></i>
                            <span>åŠ å…¥ LINE å›é¥‹èˆ‡é¼“å‹µ</span>
                        </a>
                    </div>

                    <!-- æ–°å¢ï¼šè¯çµ¡æˆ‘å€‘ é€£çµ (ä¿®æ­£ç‚º target="_blank") -->
                    <div class="mb-8">
                        <a href="mailto:newthingsinthelittlelight@gmail.com" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-5 py-2 bg-[#E6B450] text-[#8E1E20] rounded-full text-sm font-bold shadow-lg hover:bg-[#FBC02D] transition-transform active:scale-95 border border-[#8E1E20]/20">
                            <i class="fas fa-envelope text-xl"></i>
                            <span>è¯çµ¡æˆ‘å€‘</span>
                        </a>
                    </div>

                    <p>2026 God is with you | æ–°å¹´å¿«æ¨‚ Happy New Year</p>
                    <p class="mt-1 opacity-80">Â© è€¶ç©ŒåŠ æ²¹ç«™</p>
                    <div id="dataStatus" class="mt-2 text-[10px] opacity-60 flex justify-center items-center gap-2">
                        <!-- Status Indicators injected by JS -->
                    </div>
                    <div id="debugInfo" class="text-[9px] text-red-300/50 mt-1"></div>
                </footer>
            </div>
        </div>
    </div>

    <!-- Hidden Share Card for Prayer (Updated for Green Theme) -->
    <div id="prayerShareHidden" class="fixed top-0 left-0 -z-50 w-[320px] bg-[#FFFEFA] p-8 border-4 border-[#3F5846] rounded-xl opacity-0 pointer-events-none">
        <div class="text-center border-b border-[#E6C888] pb-4 mb-4">
            <h3 class="text-2xl font-bold text-[#3F5846] title-font">ç¦±å‘Šå°æ™‚å…‰</h3>
        </div>
        <h4 id="sharePrayerTitle" class="text-xl font-bold text-[#5D4037] mb-3 text-center title-font"></h4>
        <p id="sharePrayerRef" class="text-sm font-bold text-[#8B6914] bg-[#FAFAF5] p-2 rounded mb-4 text-center"></p>
        <p id="sharePrayerText" class="text-[#333] text-lg leading-relaxed text-justify font-medium"></p>
        <div class="mt-6 text-center text-[#C5A059] text-xs tracking-widest font-serif">- AMEN -</div>
        <div class="mt-2 text-center text-gray-300 text-[10px]">Jesus Vibes 2026</div>
    </div>

    <!-- Hidden Share Card for Poke/Mood (Positioned Off-screen) -->
    <div id="pokeShareHidden" style="position: fixed; left: -9999px; top: 0; width: 320px; background-color: #F0FDF4; padding: 24px; border: 4px solid #4A6351; border-radius: 12px; z-index: 50;">
        <div class="text-center border-b-2 border-green-200 pb-3 mb-4">
            <h3 class="text-2xl font-bold text-[#2F4234] title-font">æ©å…¸æˆ³æˆ³æ¨‚</h3>
            <p class="text-xs text-green-600 font-bold mt-1 tracking-widest">SOUL HEALING</p>
        </div>
         
        <h4 id="sharePokeTitle" class="text-xl font-bold text-[#14532d] mb-2 text-center title-font"></h4>
         
        <!-- Ref -->
        <div class="bg-white border-l-4 border-green-600 p-3 rounded mb-4">
             <p id="sharePokeRef" class="text-sm font-bold text-green-800"></p>
        </div>

        <!-- Text -->
        <p id="sharePokeText" class="text-[#333] text-lg leading-relaxed text-justify font-medium mb-4"></p>
         
        <!-- Song -->
        <div class="flex items-center gap-3 bg-green-100 p-3 rounded-lg">
             <div class="text-green-700 text-lg"><i class="fas fa-music"></i></div>
             <div class="text-xs font-bold text-green-800" id="sharePokeSong"></div>
        </div>

        <div class="mt-6 text-center text-green-800/40 text-[10px] tracking-widest">Jesus Vibes 2026</div>
    </div>

    <!-- Hidden Share Card for Envelope -->
    <div id="envelopeShareHidden" class="fixed top-0 left-0 -z-50 w-[320px] bg-[#B71C1C] p-6 border-4 border-[#FFD700] rounded-xl opacity-0 pointer-events-none">
        <div class="bg-white rounded-lg p-6 text-center border-2 border-[#FFD700]">
            <div class="mb-4">
                <span id="shareEnvCategory" class="text-xs bg-[#B71C1C] text-white px-3 py-1 rounded-full font-bold tracking-wide"></span>
            </div>
            <h3 id="shareEnvChinese" class="text-xl font-bold text-[#B71C1C] leading-relaxed mb-4 font-serif"></h3>
            <p id="shareEnvEnglish" class="text-xs text-gray-500 italic leading-snug mb-4 font-serif"></p>
            <div class="pt-4 border-t border-[#FFECB3]">
                <p id="shareEnvRef" class="text-sm font-bold text-[#F57F17]"></p>
            </div>
        </div>
        <div class="mt-4 text-center text-[#FFD700] text-xs font-bold tracking-widest">Jesus Vibes 2026 å¤©åœ‹å¤§ç´…åŒ…</div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">è¨Šæ¯å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>

    <script>
        const survivalInput = document.getElementById('survivalInput');
        if (survivalInput) {
            survivalInput.addEventListener('focus', () => {
                setTimeout(() => {
                   survivalInput.scrollIntoView({ behavior: "smooth", block: "center" });
                }, 300);
            });
        }
          
        // --- 3. Data Logic (Global) ---
          
        let lastVerseIndex = -1;
        let currentVerseData = null; 
        const YOUR_GOOGLE_SHEET_CSV_URL_VERSES = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=0&single=true&output=csv"; 
        const YOUR_GOOGLE_SHEET_CSV_URL_MOOD = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=1438404823&single=true&output=csv";
        const YOUR_GOOGLE_SHEET_CSV_URL_PRAYER = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=2131834293&single=true&output=csv";
        // Fixed URL for Survival Guide
        const YOUR_GOOGLE_SHEET_CSV_URL_SURVIVAL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=712066461&single=true&output=csv";
        // Fixed URL for First Aid
        const YOUR_FIRST_AID_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=2001152991&single=true&output=csv";
        // NEW: Heavenly Envelope URL
        const YOUR_HEAVENLY_ENVELOPE_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=729851481&single=true&output=csv";

        // --- QUIZ URLs ---
        const QUIZ1_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=1484195012&single=true&output=csv"; // è–ç¶“å¤§æœƒè€ƒ
        const QUIZ2_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=1420570073&single=true&output=csv"; // è–ç¶“å†·çŸ¥è­˜
        const QUIZ3_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkYqj2VRbom6fM9-afhqWbM3jNlZXdL_dy4k_vL14IuepV4YOBpxyqx732FKIJ7ePjvU4iK49tcAEt/pub?gid=1503258725&single=true&output=csv"; // é‡è¦‹å½Œè³½äº

        // Default Data
        let verses = [{ short: "è€¶å’Œè¯æ˜¯æˆ‘çš„ç‰§è€…ï¼Œæˆ‘å¿…ä¸è‡´ç¼ºä¹ã€‚(è©©ç¯‡ 23:1)", full: "è€¶å’Œè¯æ˜¯æˆ‘çš„ç‰§è€…ï¼Œæˆ‘å¿…ä¸è‡´ç¼ºä¹ã€‚ï¼ˆè©©ç¯‡ 23:1ï¼‰" }];
        let moodDatabase = [{ date: "2025/1/1", keywords: ["è¢«ç¥çœ‹è¦‹"], title: "ç¥çš„å¿ƒæ„æ˜¯å¥½çš„", text: "ä½ å¾ˆé‡è¦...", ref: "é¦¬å¤ªç¦éŸ³1:1-25", song: "ã€é–‹æˆ‘çš„é›™çœ¼ Open My Eyesã€‘| PPC", link: "https://youtu.be/XdXopI_eld4" }];
        const defaultResponses = [{ title: "è€¶ç©Œè½è¦‹äº†", text: "è¦ªæ„›çš„...", ref: "è…“ç«‹æ¯”æ›¸ 4:6-7", song: "ã€å®‰éœ Be Stillã€‘| ç´„æ›¸äºæ¨‚åœ˜", link: "https://www.youtube.com/results?search_query=å®‰éœ+Be+Still+ç´„æ›¸äºæ¨‚åœ˜" }];
        let randomPrayerDatabase = [{ date: "1/1", title: "æ–°çš„ä¸€å¹´...", ref: "è©©ç¯‡ 118:24", text: "è¦ªæ„›çš„ä¸»...", fullText: "è¦ªæ„›çš„ä¸»..." }];
        let survivalDatabase = [];
        let firstAidDatabase = [];
        let heavenlyEnvelopeDatabase = []; // New Database
        // Quiz Data
        let scholarDatabase = { quiz1: [], quiz2: [], quiz3: [] };

        // Bible Books Data for Memory Game
        const BIBLE_BOOKS = [
            "å‰µä¸–è¨˜", "å‡ºåŸƒåŠè¨˜", "åˆ©æœªè¨˜", "æ°‘æ•¸è¨˜", "ç”³å‘½è¨˜", "ç´„æ›¸äºè¨˜", "å£«å¸«è¨˜", "è·¯å¾—è¨˜", "æ’’æ¯è€³è¨˜ä¸Š", "æ’’æ¯è€³è¨˜ä¸‹",
            "åˆ—ç‹ç´€ä¸Š", "åˆ—ç‹ç´€ä¸‹", "æ­·ä»£å¿—ä¸Š", "æ­·ä»£å¿—ä¸‹", "ä»¥æ–¯æ‹‰è¨˜", "å°¼å¸Œç±³è¨˜", "ä»¥æ–¯å¸–è¨˜", "ç´„ä¼¯è¨˜", "è©©ç¯‡", "ç®´è¨€",
            "å‚³é“æ›¸", "é›…æ­Œ", "ä»¥è³½äºæ›¸", "è€¶åˆ©ç±³æ›¸", "è€¶åˆ©ç±³å“€æ­Œ", "ä»¥è¥¿çµæ›¸", "ä½†ä»¥ç†æ›¸", "ä½•è¥¿é˜¿æ›¸", "ç´„ç¥æ›¸", "é˜¿æ‘©å¸æ›¸",
            "ä¿„å·´åº•äºæ›¸", "ç´„æ‹¿æ›¸", "å½Œè¿¦æ›¸", "é‚£é´»æ›¸", "å“ˆå·´è°·æ›¸", "è¥¿ç•ªé›…æ›¸", "å“ˆè©²æ›¸", "æ’’è¿¦åˆ©äºæ›¸", "ç‘ªæ‹‰åŸºæ›¸",
            "é¦¬å¤ªç¦éŸ³", "é¦¬å¯ç¦éŸ³", "è·¯åŠ ç¦éŸ³", "ç´„ç¿°ç¦éŸ³", "ä½¿å¾’è¡Œå‚³", "ç¾…é¦¬æ›¸", "å“¥æ—å¤šå‰æ›¸", "å“¥æ—å¤šå¾Œæ›¸", "åŠ æ‹‰å¤ªæ›¸",
            "ä»¥å¼—æ‰€æ›¸", "è…“ç«‹æ¯”æ›¸", "æ­Œç¾…è¥¿æ›¸", "å¸–æ’’ç¾…å°¼è¿¦å‰æ›¸", "å¸–æ’’ç¾…å°¼è¿¦å¾Œæ›¸", "ææ‘©å¤ªå‰æ›¸", "ææ‘©å¤ªå¾Œæ›¸", "æå¤šæ›¸",
            "è…“åˆ©é–€æ›¸", "å¸Œä¼¯ä¾†æ›¸", "é›…å„æ›¸", "å½¼å¾—å‰æ›¸", "å½¼å¾—å¾Œæ›¸", "ç´„ç¿°ä¸€æ›¸", "ç´„ç¿°äºŒæ›¸", "ç´„ç¿°ä¸‰æ›¸", "çŒ¶å¤§æ›¸", "å•Ÿç¤ºéŒ„"
        ];

        // Miracles for Solitaire (1-12)
        const MIRACLES_LIST = [
            "è®Šæ°´ç‚ºé…’\nç´„ç¿°ç¦éŸ³2", 
            "é†«æ²»å¤§è‡£ä¹‹å­\nç´„ç¿°ç¦éŸ³4", 
            "é†«æ²»ç™±å­\né¦¬å¯ç¦éŸ³2", 
            "å¹³éœé¢¨å’Œæµ·\né¦¬å¯ç¦éŸ³4", 
            "è¶•å‡ºç¾¤é¬¼\né¦¬å¯ç¦éŸ³5", 
            "é†«æ²»è¡€æ¼\né¦¬å¯ç¦éŸ³5", 
            "äº”é¤…äºŒé­š\nç´„ç¿°ç¦éŸ³6", 
            "è€¶ç©Œå±¥æµ·\né¦¬å¤ªç¦éŸ³14", 
            "é†«æ²»ççœ¼\nç´„ç¿°ç¦éŸ³9", 
            "æ‹‰æ’’è·¯å¾©æ´»\nç´„ç¿°ç¦éŸ³11", 
            "ç„¡èŠ±æœæ¨¹\né¦¬å¤ªç¦éŸ³21", 
            "é†«æ²»å¤§ç—²ç˜‹\nè·¯åŠ ç¦éŸ³17"
        ];

        // Default Survival Response Fallback
        const defaultSurvivalResponse = {
            toxic: ["é€™é¡Œè·³éã€‚", "ä¸‹ä¸€é¡Œã€‚"], 
            funny: ["å“å‘€ï¼Œè¨Šè™Ÿä¸å¥½ï½"], 
            pun: ["æ±Ÿæ¹–è·¯é ï¼Œæ­¤äº‹ä¸å¿…å†æã€‚"], 
            gentle: ["è¬è¬é—œå¿ƒï¼Œæˆ‘å€‘èŠé»é–‹å¿ƒçš„å§ã€‚"], 
            drama: ["ä½ èµ°é–‹ï¼æˆ‘ä¸æƒ³çœ‹åˆ°ä½ ï¼"], // New Default for Drama
            ancient: ["å¤©æ©Ÿä¸å¯æ´©æ¼ã€‚"]
        };
          
        function loadAllData() {
            if(YOUR_GOOGLE_SHEET_CSV_URL_VERSES) fetchData('verses', YOUR_GOOGLE_SHEET_CSV_URL_VERSES);
            if(YOUR_GOOGLE_SHEET_CSV_URL_MOOD) fetchData('mood', YOUR_GOOGLE_SHEET_CSV_URL_MOOD);
            if(YOUR_GOOGLE_SHEET_CSV_URL_PRAYER) fetchData('prayer', YOUR_GOOGLE_SHEET_CSV_URL_PRAYER);
            if(YOUR_GOOGLE_SHEET_CSV_URL_SURVIVAL) fetchData('survival', YOUR_GOOGLE_SHEET_CSV_URL_SURVIVAL);
            if(YOUR_FIRST_AID_CSV_URL) fetchFirstAidData(YOUR_FIRST_AID_CSV_URL);
            if(YOUR_HEAVENLY_ENVELOPE_CSV_URL) fetchData('heavenlyEnvelope', YOUR_HEAVENLY_ENVELOPE_CSV_URL); // New Fetch
            
            // Load Quizzes
            fetchData('quiz1', QUIZ1_URL);
            fetchData('quiz2', QUIZ2_URL);
            fetchData('quiz3', QUIZ3_URL);
        }

        async function fetchData(type, url) {
            try {
                // Add cache: 'no-store' to ensure fresh data
                const response = await fetch(url + `&t=${new Date().getTime()}`, { 
                    redirect: 'follow',
                    cache: 'no-store'
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                if (text.trim().startsWith('<!DOCTYPE html>')) { updateStatus(type, false); return; }

                Papa.parse(text, {
                    header: true, skipEmptyLines: true, transformHeader: h => h.trim(),
                    complete: function(results) { processData(type, results.data); updateStatus(type, true); },
                    error: function(err) { console.error(`Error parsing ${type}:`, err); updateStatus(type, false); }
                });
            } catch (e) { console.error(`Fetch failed for ${type}:`, e); updateStatus(type, false); }
        }

        // --- 1. SMART COLUMN MATCHING ---
        function getValue(row, keyOptions) {
            const rowKeys = Object.keys(row);
            
            // 1. Try exact match first for all options (Priority)
            for (const option of keyOptions) {
                if (row[option] !== undefined) return row[option];
            }

            // 2. Try normalized exact match (Case insensitive, trim, BOM removal)
            for (const option of keyOptions) {
                const target = option.trim().toLowerCase().replace(/[()]/g, '');
                // Handle BOM or invisible characters in keys
                const exactMatch = rowKeys.find(k => {
                    // Remove BOM \uFEFF and other common invisible chars
                    const cleanKey = k.replace(/^\uFEFF/, '').trim().toLowerCase().replace(/[()]/g, '');
                    return cleanKey === target;
                });
                if (exactMatch) return row[exactMatch];
            }

            // 3. Try fuzzy match (includes) - ONLY if strict failed
            for (const option of keyOptions) {
                const target = option.trim().toLowerCase().replace(/[()]/g, '');
                const fuzzyMatch = rowKeys.find(k => {
                    const cleanKey = k.replace(/^\uFEFF/, '').trim().toLowerCase().replace(/[()]/g, '');
                    return cleanKey.includes(target);
                });
                if (fuzzyMatch) return row[fuzzyMatch];
            }
            return '';
        }

        // Utility for normalization (Full-width to Half-width and cleanup)
        function normalizeAnswer(str) {
            if(!str) return '';
            // Remove BOM and invisible chars first
            let s = str.replace(/[\uFEFF\u200B\u200C\u200D\u2060\u180E]/g, '');
            // Full-width to Half-width
            s = s.replace(/[\uFF01-\uFF5E]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0)).replace(/\u3000/g, ' ');
            s = s.trim().toUpperCase();
            
            // 1. Check for single letter pattern like "A" or "(A)" or "A." or "A)"
            // Matches A, B, C, D at start or surrounded by non-word chars
            const letterMatch = s.match(/^[\(\[\s]*([A-D])[\)\]\.\s]*$/); 
            if(letterMatch) return letterMatch[1]; 
            
            // 2. If it's a number 1, 2, 3, 4
            const numMatch = s.match(/^[\(\[\s]*([1-4])[\)\]\.\s]*$/);
            if(numMatch) {
                return ['A', 'B', 'C', 'D'][parseInt(numMatch[1]) - 1];
            }

            // 3. If no clear letter, return cleaned string for text comparison
            // Remove decorations to make text comparison robust
            return s.replace(/[\(\)\.\,\s\"\'\-\_]/g, ''); 
        }

        // Helper for text comparison (used in double-check)
        function normalizeTextForComparison(str) {
            if(!str) return '';
            let s = str.replace(/[\uFEFF\u200B\u200C\u200D\u2060\u180E]/g, '');
            s = s.replace(/[\uFF01-\uFF5E]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0)).replace(/\u3000/g, ' ');
            return s.replace(/[\(\)\.\,\s\"\'\-\_]/g, '').trim().toUpperCase();
        }

        function processData(type, data) {
            if (!data || data.length === 0) return;
            
            if(type === 'verses') {
                verses = data.map(r => {
                    let fullT = getValue(r, ['full', 'å®Œæ•´', 'å®Œæ•´ç¶“æ–‡']).trim();
                    const match = fullT.match(/[\(\uff08](.*?)[\)\uff09]$/);
                    if (match && match[1] && fullT.startsWith(match[1].trim())) fullT = fullT.substring(match[1].trim().length).replace(/^[:ï¼š\s\.,]+/, '').trim();
                    return { short: getValue(r, ['short', 'çŸ­å¥', 'ç¶“æ–‡']).trim(), full: fullT };
                }).filter(r => r.short && r.full);
            } else if (type === 'mood') {
                moodDatabase = data.map(r => ({
                    date: getValue(r, ['date', 'æ—¥æœŸ']).trim(),
                    keywords: getValue(r, ['keywords', 'é—œéµå­—']) ? getValue(r, ['keywords', 'é—œéµå­—']).split(/[,ï¼Œ|ã€\s]+/).filter(k=>k) : [],
                    title: getValue(r, ['title', 'æ¨™é¡Œ']).trim(), text: getValue(r, ['text', 'å…§å®¹', 'å›æ‡‰']).trim(), ref: getValue(r, ['ref', 'ç¶“æ–‡', 'å‡ºè™•']).trim(), song: getValue(r, ['song', 'è©©æ­Œ']).trim() || "é‡è¦‹ä½ ï¼Œæˆ‘å°±é‡è¦‹å¹¸ç¦", link: getValue(r, ['link', 'é€£çµ']).trim() || "https://youtu.be/XdXopI_eld4"
                }));
            } else if (type === 'prayer') {
                randomPrayerDatabase = data.map(r => ({ title: getValue(r, ['title', 'æ¨™é¡Œ']).trim(), ref: getValue(r, ['ref', 'ç¶“æ–‡']).trim(), text: getValue(r, ['text', 'çŸ­ç¦±å‘Š']).trim(), fullText: getValue(r, ['fullText', 'å®Œæ•´ç¦±å‘Š']).trim() })).filter(r => r.title);
            } else if (type === 'survival') {
                survivalDatabase = data.map(r => ({
                    keywords: getValue(r, ['keywords', 'é—œéµå­—', 'å•é¡Œ']).split(/[,ï¼Œ|ã€\s]+/).filter(k=>k),
                    toxic: getValue(r, ['çŠ€åˆ©é¢¨', 'toxic']).split('|').filter(s=>s.trim()),
                    funny: getValue(r, ['å¹½é»˜é¢¨', 'funny']).split('|').filter(s=>s.trim()),
                    pun: getValue(r, ['ä¿ å®¢é¢¨', 'pun']).split('|').filter(s=>s.trim()),
                    gentle: getValue(r, ['æº«æŸ”é¢¨', 'gentle']).split('|').filter(s=>s.trim()),
                    drama: getValue(r, ['å…«é»æª”é¢¨', 'å…«é»æª”', 'drama']).split('|').filter(s=>s.trim()),
                    ancient: getValue(r, ['å¤å¶é¢¨', 'ancient']).split('|').filter(s=>s.trim())
                }));
                const count = survivalDatabase.length;
                document.getElementById('hub-survival-status').innerText = `å·²è¼‰å…¥ ${count} æ‹›`;
                document.getElementById('survival-count-display').innerText = `ç¥•ç±é æ•¸ï¼š${count}`;
            } else if (type === 'quiz1' || type === 'quiz2' || type === 'quiz3') {
                // Process Quiz Data
                scholarDatabase[type] = data.map(r => {
                    let answerRaw = getValue(r, ['æ­£ç¢ºç­”æ¡ˆ', 'Correct Answer', 'Answer', 'ans']);
                    
                    // Fallback Logic
                    if (answerRaw.length > 5) {
                        if (r['æ­£ç¢ºç­”æ¡ˆ']) answerRaw = r['æ­£ç¢ºç­”æ¡ˆ'];
                        else if (r['Correct Answer']) answerRaw = r['Correct Answer'];
                        else if (r['Answer']) answerRaw = r['Answer'];
                    }

                    return {
                        category: getValue(r, ['é¡åˆ¥', 'category']),
                        question: getValue(r, ['é¡Œç›®', 'question', 'q']),
                        options: [
                            getValue(r, ['é¸é …A', 'Option A', 'A']) || '',
                            getValue(r, ['é¸é …B', 'Option B', 'B']) || '',
                            getValue(r, ['é¸é …C', 'Option C', 'C']) || '',
                            getValue(r, ['é¸é …D', 'Option D', 'D']) || ''
                        ], 
                        // Fix: Normalize answer (Full-width to Half-width, Trim, Upper)
                        answer: normalizeAnswer(answerRaw),
                        note: getValue(r, ['å‚™è¨»', 'Note', 'Explanation', 'è§£æ', 'æ­£ç¢ºç­”æ¡ˆè§£æ'])
                    };
                }).filter(q => q.question && q.answer);
            } else if (type === 'heavenlyEnvelope') {
                // New Processing Logic
                heavenlyEnvelopeDatabase = data.map(r => ({
                    ref: getValue(r, ['ç¶“æ–‡å‡ºè™•', 'Reference', 'ref']),
                    category: getValue(r, ['åˆ†é¡', 'Category', 'cat']),
                    chinese: getValue(r, ['ä¸­æ–‡ç¶“æ–‡(å’Œåˆæœ¬)', 'ä¸­æ–‡ç¶“æ–‡', 'Chinese Verse']),
                    english: getValue(r, ['EnglishVerse(KJV)', 'EnglishVerse', 'English'])
                })).filter(r => r.chinese);
            }
        }

        function updateStatus(type, success) {
            const statusDiv = document.getElementById('dataStatus'); if(!statusDiv) return;
            const dotId = `status-${type}`; let dot = document.getElementById(dotId);
            if(!dot) { dot = document.createElement('div'); dot.id = dotId; dot.className = 'status-dot'; statusDiv.appendChild(dot); }
            dot.className = `status-dot ${success ? 'status-success' : 'status-error'}`;
        }
         
        function updateDebugInfo(msg) {
            const debugEl = document.getElementById('debugInfo');
            if(debugEl) {
                const current = debugEl.innerText;
                debugEl.innerText = current ? `${current} | ${msg}` : msg;
            }
        }
          
        // -------------------------
        // 4. View Navigation Logic
        // -------------------------

        let currentStyle = 'toxic';
        let views = { 
            menu: document.getElementById('home-menu'), 
            scratch: document.getElementById('scratch-view'), 
            talk: document.getElementById('talk-view'),
            prayer: document.getElementById('prayer-view'),
            survivalHub: document.getElementById('survival-hub-view'),
            survivalGuide: document.getElementById('survival-view'),
            firstAid: document.getElementById('first-aid-view'),
            scholarHub: document.getElementById('scholar-hub-view'),
            gameHub: document.getElementById('game-hub-view'),
            quizView: document.getElementById('quiz-view'),
            fruitGame: document.getElementById('fruit-game-view'), 
            memoryGame: document.getElementById('memory-game-view'), 
            solitaireGame: document.getElementById('solitaire-game-view'), // New Solitaire View
            heavenlyEnvelope: document.getElementById('heavenly-envelope-view')
        };
        const homeHeader = document.getElementById('home-header');
        const innerNavBar = document.getElementById('inner-nav-bar');

        function hideAllViews() { Object.values(views).forEach(el => { if(el) { el.classList.add('hidden'); el.classList.remove('fade-in'); } }); }
        function forceScrollReset() { const wrapper = document.getElementById('scroll-wrapper'); if(wrapper) wrapper.scrollTop = 0; }

        function showHome() { 
            hideAllViews(); views.menu.classList.remove('hidden'); views.menu.classList.add('fade-in'); 
            homeHeader.style.display = 'block'; innerNavBar.style.display = 'none'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.remove('hide-lanterns');
        }
          
        function showScratch() { 
            hideAllViews(); views.scratch.classList.remove('hidden'); views.scratch.classList.add('fade-in'); 
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            setTimeout(initScratchCard, 200); document.querySelector('.lantern-container').classList.add('hide-lanterns');
        }
          
        function showPrayer() { 
            hideAllViews(); views.prayer.classList.remove('hidden'); views.prayer.classList.add('fade-in'); 
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.add('hide-lanterns');
            // Reset Prayer View
            document.getElementById('bookCover').classList.remove('hidden'); document.getElementById('bookPage').classList.add('hidden'); document.getElementById('prayerActionButtons').classList.add('hidden'); document.getElementById('prayerToggleBtn').innerHTML = '<i class="fas fa-book-open mr-1"></i> ğŸ“– é–±è®€å®Œæ•´ç¦±å‘Š';
        }
          
        function showTalk() { 
            hideAllViews(); views.talk.classList.remove('hidden'); views.talk.classList.add('fade-in'); 
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.add('hide-lanterns'); initPokeGame();
        }

        // --- NEW: Survival Hub Logic ---
        function showSurvivalHub() {
            hideAllViews(); views.survivalHub.classList.remove('hidden'); views.survivalHub.classList.add('fade-in');
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.add('hide-lanterns');
        }

        function showSurvivalGuide() { 
            hideAllViews(); views.survivalGuide.classList.remove('hidden'); views.survivalGuide.classList.add('fade-in'); 
            document.getElementById('survival-intro').classList.remove('hidden');
            document.getElementById('survival-content').classList.add('hidden');
            document.getElementById('survivalInput').value = '';
            document.getElementById('survivalText').innerText = '';
        }

        function showFirstAid() {
            hideAllViews(); views.firstAid.classList.remove('hidden'); views.firstAid.classList.add('fade-in');
            initFirstAidUI();
        }
        
        // --- NEW: Scholar & Game Hub Logic ---
        function showScholarHub() {
            hideAllViews(); views.scholarHub.classList.remove('hidden'); views.scholarHub.classList.add('fade-in');
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.add('hide-lanterns');
        }

        function showGameHub() {
            hideAllViews(); views.gameHub.classList.remove('hidden'); views.gameHub.classList.add('fade-in');
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset(); 
            document.querySelector('.lantern-container').classList.add('hide-lanterns');
        }
          
        function startSurvival() {
            document.getElementById('survival-intro').classList.add('hidden');
            document.getElementById('survival-content').classList.remove('hidden');
        }

        // --- NEW: Heavenly Envelope Logic ---
        function showHeavenlyEnvelope() {
            hideAllViews(); views.heavenlyEnvelope.classList.remove('hidden'); views.heavenlyEnvelope.classList.add('fade-in');
            homeHeader.style.display = 'none'; innerNavBar.style.display = 'flex'; forceScrollReset();
            document.querySelector('.lantern-container').classList.add('hide-lanterns');
            
            // Reset Envelope State
            const card = document.getElementById('redEnvelopeCard');
            const actions = document.getElementById('envelope-actions');
            card.classList.remove('opened');
            actions.classList.add('hidden');
        }

        function simulateGameWin(gameName) {
            showToast(`ğŸ® æ­£åœ¨è¼‰å…¥ ${gameName}...`);
            setTimeout(() => {
                showToast("ğŸ‰ éŠæˆ²é€šé—œï¼æº–å‚™é ˜å–å¤§ç´…åŒ…ï¼");
                setTimeout(showHeavenlyEnvelope, 1500);
            }, 1000);
        }

        function openRedEnvelope() {
            const card = document.getElementById('redEnvelopeCard');
            if(card.classList.contains('opened')) return; // Prevent re-opening
            
            // Pick a random verse
            if(!heavenlyEnvelopeDatabase.length) {
                showToast("ç´…åŒ…è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œ...");
                return;
            }
            
            const verse = heavenlyEnvelopeDatabase[Math.floor(Math.random() * heavenlyEnvelopeDatabase.length)];
            
            // Fill Data
            document.getElementById('env-category').innerText = verse.category || "ç¥ç¦";
            document.getElementById('env-chinese').innerText = verse.chinese || "é¡˜ä¸»è³œç¦ä¿è­·ä½ ";
            document.getElementById('env-english').innerText = verse.english || "";
            document.getElementById('env-ref').innerText = verse.ref || "";

            // Animate
            card.classList.add('opened');
            
            // Show actions after animation
            setTimeout(() => {
                document.getElementById('envelope-actions').classList.remove('hidden');
            }, 800);
        }

        function shareEnvelope() {
            const cat = document.getElementById('env-category').innerText;
            const chi = document.getElementById('env-chinese').innerText;
            const eng = document.getElementById('env-english').innerText;
            const ref = document.getElementById('env-ref').innerText;
            
            document.getElementById('shareEnvCategory').innerText = cat;
            document.getElementById('shareEnvChinese').innerText = chi;
            document.getElementById('shareEnvEnglish').innerText = eng;
            document.getElementById('shareEnvRef').innerText = ref;
            
            const shareCard = document.getElementById('envelopeShareHidden');
            shareCard.style.opacity = '1';
            
            captureAndShare('envelopeShareHidden', 'Jesus Vibes 2026', `ğŸ§§ æˆ‘çš„å¤©åœ‹å¤§ç´…åŒ… ğŸ§§\n\nã€${cat}ã€‘\n${chi}\n\n${eng}\n\nğŸ“– ${ref}`).then(() => {
                shareCard.style.opacity = '0';
            });
        }

        window.selectStyle = function(el, style) {
            currentStyle = style;
            document.querySelectorAll('.style-pill').forEach(pill => { pill.classList.remove('active'); });
            el.classList.add('active');
        }

        /* --------------------------
            EXISTING LOGIC: Scratch, Poke, Prayer, Survival Guide
            -------------------------- */
        const canvas = document.getElementById('scratchCanvas');
        const ctx = canvas.getContext('2d');
        const verseTextDiv = document.getElementById('verseText');
        let isDrawing = false; let lastPoint = null;
        function initScratchCard() {
            const container = document.querySelector('.scratch-box'); if (!container || container.offsetWidth === 0) return;
            canvas.width = container.offsetWidth; canvas.height = container.offsetHeight;
            ctx.globalCompositeOperation = 'source-over'; ctx.fillStyle = '#C0C0C0'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#A9A9A9'; for(let i=0; i<20; i++) { ctx.beginPath(); ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, Math.random()*3+1, 0, Math.PI*2); ctx.fill(); }
            ctx.fillStyle = '#666'; ctx.font = 'bold 24px "Noto Serif TC", serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText("âœ¨ åˆ®é–‹é ˜å— âœ¨", canvas.width/2, canvas.height/2);
            let newIndex = (verses.length > 1) ? Math.floor(Math.random() * verses.length) : 0; 
            currentVerseData = verses[newIndex]; verseTextDiv.innerText = currentVerseData.full; 
            ctx.globalCompositeOperation = 'destination-out';
        }
        function getBrushPos(e) { const rect = canvas.getBoundingClientRect(); return { x: (e.touches ? e.touches[0].clientX : e.clientX) - rect.left, y: (e.touches ? e.touches[0].clientY : e.clientY) - rect.top }; }
        function startDraw(e) { isDrawing = true; lastPoint = getBrushPos(e); ctx.beginPath(); ctx.globalCompositeOperation = 'destination-out'; ctx.arc(lastPoint.x, lastPoint.y, 25, 0, Math.PI * 2); ctx.fill(); }
        function stopDraw() { isDrawing = false; lastPoint = null; }
        function scratch(e) { if (!isDrawing) return; e.preventDefault(); const currentPoint = getBrushPos(e); ctx.beginPath(); ctx.globalCompositeOperation = 'destination-out'; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.lineWidth = 50; if (lastPoint) { ctx.moveTo(lastPoint.x, lastPoint.y); ctx.lineTo(currentPoint.x, currentPoint.y); ctx.stroke(); } lastPoint = currentPoint; }
        canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('touchstart', startDraw, {passive: false});
        window.addEventListener('mouseup', stopDraw); window.addEventListener('touchend', stopDraw);
        canvas.addEventListener('mousemove', scratch); canvas.addEventListener('touchmove', scratch, {passive: false});
        function resetScratchCard() { const btn = document.querySelector('.action-group .btn-green i'); btn.classList.add('fa-spin'); verseTextDiv.style.opacity = '0'; canvas.style.opacity = '0'; setTimeout(() => { initScratchCard(); canvas.style.opacity = '1'; setTimeout(() => { verseTextDiv.style.opacity = '1'; btn.classList.remove('fa-spin'); }, 50); }, 300); }

        function initPokeGame() {
            document.getElementById('responseArea').classList.add('hidden'); document.getElementById('resetPokeBtn').classList.add('hidden');
            const grid = document.getElementById('pokeGrid'); grid.innerHTML = ''; 
            const icons = ['fa-gift', 'fa-star', 'fa-heart', 'fa-music', 'fa-fish', 'fa-dove', 'fa-bible', 'fa-praying-hands', 'fa-church', 'fa-lightbulb', 'fa-smile', 'fa-sun'].sort(() => Math.random() - 0.5);
            const colors = ['bg-red-500', 'bg-orange-500', 'bg-amber-400', 'bg-yellow-400', 'bg-lime-500', 'bg-green-500', 'bg-emerald-500', 'bg-teal-500', 'bg-cyan-500', 'bg-sky-500', 'bg-blue-500', 'bg-violet-500'];
            for(let i=0; i<12; i++) {
                const box = document.createElement('div'); box.className = 'poke-box';
                box.innerHTML = `<div class="poke-paper ${colors[i]} flex flex-col items-center justify-center text-white"><i class="fas ${icons[i]} text-2xl opacity-80"></i><span class="text-[10px] mt-1 font-bold opacity-60">Poke</span></div>`;
                box.onclick = () => { if(box.classList.contains('poked')) return; box.classList.add('poked'); setTimeout(() => { getRandomMoodResponse(); document.getElementById('resetPokeBtn').classList.remove('hidden'); }, 300); };
                grid.appendChild(box);
            }
        }
        function getRandomMoodResponse() {
            const area = document.getElementById('responseArea'); area.classList.remove('hidden');
            document.getElementById('scroll-wrapper').scrollTo({ top: area.getBoundingClientRect().top + document.getElementById('scroll-wrapper').scrollTop - 80, behavior: 'smooth' });
            document.getElementById('responseText').innerText = '...';
            setTimeout(() => {
                const item = (moodDatabase && moodDatabase.length) ? moodDatabase[Math.floor(Math.random() * moodDatabase.length)] : defaultResponses[0];
                document.getElementById('responseTitle').innerText = item.title;
                document.getElementById('responseDate').innerText = item.date || 'Today';
                document.getElementById('responseText').innerText = item.text;
                document.getElementById('responseRef').innerText = item.ref;
                
                // Modified logic for song link
                const songEl = document.getElementById('responseSong');
                if (item.link) {
                    songEl.innerHTML = `<a href="${item.link}" target="_blank" class="flex items-center gap-1 hover:text-green-600 transition-colors cursor-pointer">
                        <span class="truncate">${item.song}</span> 
                        <i class="fas fa-play-circle text-green-500"></i>
                    </a>`;
                } else {
                    songEl.innerText = item.song;
                }
            }, 600);
        }

        function openPrayerBook() {
            if (!randomPrayerDatabase.length) return;
            document.getElementById('bookCover').classList.add('hidden'); document.getElementById('bookPage').classList.remove('hidden');
            const item = randomPrayerDatabase[Math.floor(Math.random() * randomPrayerDatabase.length)];
            document.getElementById('prayerBookTitle').innerText = item.title; document.getElementById('prayerBookRef').innerText = item.ref;
            document.getElementById('prayerBookText').innerText = item.text; document.getElementById('prayerBookFullText').innerText = item.fullText;
            document.getElementById('prayerBookFullContent').classList.add('hidden');
            setTimeout(() => document.getElementById('prayerActionButtons').classList.remove('hidden'), 600);
        }
        function toggleFullPrayer() {
            const el = document.getElementById('prayerBookFullContent'); const btn = document.getElementById('prayerToggleBtn');
            el.classList.toggle('hidden'); btn.innerHTML = el.classList.contains('hidden') ? '<i class="fas fa-book-open mr-1"></i> ğŸ“– é–±è®€å®Œæ•´ç¦±å‘Š' : '<i class="fas fa-chevron-up mr-1"></i> æ”¶èµ·å®Œæ•´ç¦±å‘Š';
        }

        // --- 2. RELAXED SEARCH MATCHING ---
        function getMatchScore(input, keyword) {
            let cleanIn = input.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "").toLowerCase(); 
            let cleanKey = keyword.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "").toLowerCase();
            if (cleanIn.includes(cleanKey) || cleanKey.includes(cleanIn)) return 1.0;
            let matchCount = 0; 
            for (let char of cleanKey) if (cleanIn.includes(char)) matchCount++;
            return matchCount / cleanKey.length;
        }

        function getSurvivalResponse() {
            const inputVal = document.getElementById('survivalInput').value.trim(); if (!inputVal) return;
            const styleBadge = document.getElementById('styleBadge'); const textEl = document.getElementById('survivalText');
            document.getElementById('survivalResponseArea').classList.remove('hidden');
            const styleNames = { 'toxic': 'ğŸ çŠ€åˆ©é¢¨', 'funny': 'ğŸ¤£ å¹½é»˜é¢¨', 'pun': 'âš”ï¸ ä¿ å®¢é¢¨', 'gentle': 'ğŸ•Šï¸ æº«æŸ”é¢¨', 'drama': 'ğŸ­ å…«é»æª”é¢¨', 'ancient': 'ğŸ“œ å¤å¶é¢¨' };
            styleBadge.innerText = styleNames[currentStyle]; textEl.innerText = 'æ€è€ƒä¸­...';
            setTimeout(() => {
                let bestMatch = null; let bestScore = 0;
                for (const item of survivalDatabase) {
                    if (!item[currentStyle]) continue;
                    for (const k of item.keywords) {
                        const score = getMatchScore(inputVal, k);
                        if (score > bestScore) { bestScore = score; bestMatch = item; }
                    }
                }
                let result = "";
                if (bestMatch && bestScore > 0.4) {
                    const ans = bestMatch[currentStyle]; result = Array.isArray(ans) ? ans[Math.floor(Math.random()*ans.length)] : ans;
                } else {
                    const pool = defaultSurvivalResponse[currentStyle]; result = pool[Math.floor(Math.random()*pool.length)];
                }
                textEl.innerText = result;
            }, 800);
        }

        /* --------------------------
            NEW MODULE: Bible First Aid Kit Logic (FIXED)
            -------------------------- */
        const customSearchLogic = {
            "æ²’éŒ¢": (item) => item.category === "è·å ´è²¡å¯Œ" || item.keywords.some(k => ["éŒ¢", "å¯Œè¶³", "ä¾›æ‡‰", "ç¼ºä¹", "è²¡ç‰©"].some(w => k.includes(w))),
            "æ°´é€†": (item) => ["é€†å¢ƒç¿»ç›¤", "æ–°å¹´è½‰é‹", "å‡ºå…¥å¹³å®‰"].includes(item.category) || item.keywords.some(k => ["é †åˆ©", "å¹³å®‰", "ç½å®³", "ä¿å®ˆ", "é‹æ°£"].some(w => k.includes(w))),
            "ç¡ä¸è‘—": (item) => ["ç¡çœ å®‰æ¯", "æƒ…ç·’æ€¥æ•‘"].includes(item.category) || item.keywords.some(k => ["å¤±çœ ", "å®‰æ¯", "èººè‡¥", "ç¡çœ "].some(w => k.includes(w))),
            "è¢«å‚¬å©š": (item) => item.category === "å–®èº«æ‡‰å°" || item.keywords.some(k => ["å‚¬å©š", "ç­‰å€™", "å®šæ™‚", "çµå©š"].some(w => k.includes(w))),
            "å­¤å–®": (item) => item.category === "é¢å°å­¤å–®" || item.keywords.some(k => ["å­¤å–®", "åŒåœ¨", "æœ‹å‹", "é‚Šç·£"].some(w => k.includes(w))),
            "ä¸æƒ³ä¸Šç­": (item) => ["è·å ´æ™ºæ…§", "æœªä¾†æ–¹å‘"].includes(item.category) || item.keywords.some(k => ["å·¥ä½œ", "èƒ½åŠ›", "è€é—†", "æ‡¶æƒ°"].some(w => k.includes(w))),
            "èƒ–": (item) => ["é£²é£Ÿå¥åº·", "ç¯€åˆ¶è‡ªå¾‹", "è‡ªæˆ‘æ¥ç´"].includes(item.category) || item.keywords.some(k => ["æ¸›è‚¥", "èº«é«”", "è‚šè…¹"].some(w => k.includes(w))),
            "å°äºº": (item) => ["äººéš›ç•Œç·š", "é€†å¢ƒç¿»ç›¤"].includes(item.category) || item.keywords.some(k => ["å°äºº", "ä»‡æ•µ", "é™·å®³", "è¢«ç½µ"].some(w => k.includes(w))),
            "éº»å°‡è¼¸": (item) => ["è·å ´è²¡å¯Œ", "é€†å¢ƒç¿»ç›¤"].includes(item.category) || item.keywords.some(k => ["é‹æ°£", "å¯Œè¶³"].some(w => k.includes(w))),
            "æ‰‹æ°£èƒŒ": (item) => item.category === "æ–°å¹´è½‰é‹" || item.keywords.some(k => ["æ©Ÿæœƒ", "å¾—å‹", "æ–°äº‹"].some(w => k.includes(w))),
            "å¡è»Š": (item) => ["å¿è€ç­‰å€™", "å‡ºå…¥å¹³å®‰"].includes(item.category) || item.keywords.some(k => ["å¿è€", "ä¿å®ˆ", "é“è·¯"].some(w => k.includes(w))),
            "æšˆè»Š": (item) => item.category === "å¹³å®‰å¥åº·" || item.keywords.some(k => ["é†«æ²»", "å¥å£¯"].some(w => k.includes(w))),
            "ç´…åŒ…å¤ªå¤š": (item) => ["æ…·æ…¨çµ¦äºˆ", "è²¡å‹™æ™ºæ…§"].includes(item.category) || item.keywords.some(k => ["æ–½æ¨", "çµ¦äºˆ", "ç¨®"].some(w => k.includes(w))),
            "æ²’ç´…åŒ…": (item) => item.category === "ç¶“æ¿Ÿä¾›æ‡‰" || item.keywords.some(k => ["è³è³œ", "ç¦®ç‰©", "ç”¢æ¥­"].some(w => k.includes(w))),
            "å¤§æƒé™¤": (item) => item.keywords.some(k => ["æ‡¶æƒ°", "åŠ›é‡", "åšå·¥", "ç–²ä¹"].some(w => k.includes(w))),
            "çˆ›åœ¨æ²™ç™¼": (item) => item.category === "ç¯€åˆ¶è‡ªå¾‹" || item.keywords.some(k => ["ä¼‘æ¯", "å…‰é™°"].some(w => k.includes(w))),
            "è¦ªæˆšåµ": (item) => item.category === "äººéš›ç•Œç·š" || item.keywords.some(k => ["é–‰å˜´", "å®‰éœ", "è¨€èª", "å£èˆŒ"].some(w => k.includes(w))),
            "å•æˆç¸¾": (item) => item.category === "æ‹’çµ•æ¯”è¼ƒ" || item.keywords.some(k => ["åƒ¹å€¼", "æ¯”è¼ƒ", "ç‚ºé¦–"].some(w => k.includes(w))),
            "å°å­©å°–å«": (item) => item.category === "å®¶åº­æ•™é¤Š" || item.keywords.some(k => ["å¿è€", "æ•™é¤Š", "å…’å¥³"].some(w => k.includes(w))),
            "åƒå¤ªæ’": (item) => item.category === "é£²é£Ÿå¥åº·" || item.keywords.some(k => ["è‚šè…¹", "ç¯€åˆ¶"].some(w => k.includes(w))),
            "å–æ›": (item) => item.keywords.some(k => ["é…’", "æ¸…é†’", "é†‰"].some(w => k.includes(w)))
        };

        const hotTags = [
            { label: "ğŸ’¸ ç¼ºéŒ¢", query: "æ²’éŒ¢", class: "tag-money" },
            { label: "ğŸ˜° æ°´é€†", query: "æ°´é€†", class: "tag-money" },
            { label: "ğŸ¼ ç¡ä¸è‘—", query: "ç¡ä¸è‘—", class: "tag-tired" },
            { label: "ğŸ’ è¢«å‚¬å©š", query: "è¢«å‚¬å©š", class: "tag-lonely" },
            { label: "ğŸ‚ è¦ºå¾—å­¤å–®", query: "å­¤å–®", class: "tag-lonely" },
            { label: "ğŸ‘‹ æƒ³é›¢è·", query: "ä¸æƒ³ä¸Šç­", class: "tag-lost" },
            { label: "ğŸ· æ¸›è‚¥å¤±æ•—", query: "èƒ–", class: "tag-full" },
            { label: "ğŸ˜¤ é‡åˆ°å°äºº", query: "å°äºº", class: "tag-gray" },
            { label: "ğŸ€„ï¸ éº»å°‡ä¸€ç›´è¼¸", query: "éº»å°‡è¼¸", class: "tag-money" },
            { label: "ğŸƒ æ‰‹æ°£èƒŒåˆ°çˆ†", query: "æ‰‹æ°£èƒŒ", class: "tag-money" },
            { label: "ğŸš— å¡è»Šå¥½ç—›è‹¦", query: "å¡è»Š", class: "tag-tired" },
            { label: "ğŸ¤¢ æšˆè»Šæƒ³å", query: "æšˆè»Š", class: "tag-tired" },
            { label: "ğŸ’¸ ç´…åŒ…åŒ…å¤ªå¤š", query: "ç´…åŒ…å¤ªå¤š", class: "tag-money" },
            { label: "ğŸ§§ æ²’é ˜åˆ°ç´…åŒ…", query: "æ²’ç´…åŒ…", class: "tag-money" },
            { label: "ğŸ§¹ å¤§æƒé™¤å¥½ç´¯", query: "å¤§æƒé™¤", class: "tag-tired" },
            { label: "ğŸ›Œ åªæƒ³çˆ›åœ¨æ²™ç™¼", query: "çˆ›åœ¨æ²™ç™¼", class: "tag-tired" },
            { label: "ğŸ™‰ è¦ªæˆšå¤ªåµ", query: "è¦ªæˆšåµ", class: "tag-gray" },
            { label: "ğŸ“ è¢«å•æˆç¸¾/è–ªæ°´", query: "å•æˆç¸¾", class: "tag-lonely" },
            { label: "ğŸ‘¶ å°å­©å¤±æ§å°–å«", query: "å°å­©å°–å«", class: "tag-gray" },
            { label: "ğŸ– åƒå¤ªæ’", query: "åƒå¤ªæ’", class: "tag-full" },
            { label: "ğŸº å–æ›äº†", query: "å–æ›", class: "tag-full" }
        ];

        const categoryVisuals = {
            "è·å ´è²¡å¯Œ": { icon: "fa-coins", bg: "bg-yellow-100", text: "text-yellow-700", border: "border-yellow-200" },
            "äººéš›å®¶åº­": { icon: "fa-users", bg: "bg-pink-100", text: "text-pink-700", border: "border-pink-200" },
            "æƒ…ç·’æ€¥æ•‘": { icon: "fa-heart-pulse", bg: "bg-red-100", text: "text-red-700", border: "border-red-200" },
            "æœªä¾†æ–¹å‘": { icon: "fa-compass", bg: "bg-blue-100", text: "text-blue-700", border: "border-blue-200" },
            "å¹³å®‰å¥åº·": { icon: "fa-shield-heart", bg: "bg-green-100", text: "text-green-700", border: "border-green-200" },
            "ä¿¡å¿ƒå‹‡æ°£": { icon: "fa-crown", bg: "bg-purple-100", text: "text-purple-700", border: "border-purple-200" }
        };

        function initFirstAidUI() {
            const list = document.getElementById('hotTagsList');
            if(list && list.children.length === 0) {
                list.innerHTML = hotTags.map(tag => `<div class="hot-tag-btn ${tag.class}" onclick="renderSearchResults('${tag.query}', false, true)">${tag.label}</div>`).join('');
            }
        }

        async function fetchFirstAidData(url) {
            try {
                if(!url) { updateStatus('first-aid', false); return; }
                const response = await fetch(url + `&t=${new Date().getTime()}`, { redirect: 'follow', cache: 'no-store' });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                if (text.trim().startsWith('<!DOCTYPE html>')) { updateStatus('first-aid', false); return; }
                Papa.parse(text, {
                    header: true, skipEmptyLines: true, transformHeader: h => h.trim(),
                    complete: function(results) { processFirstAidData(results.data); updateStatus('first-aid', true); },
                    error: function(err) { updateStatus('first-aid', false); }
                });
            } catch (e) { updateStatus('first-aid', false); }
        }

        function processFirstAidData(data) {
            firstAidDatabase = data.map(r => {
                let cat = (getValue(r, ['æ­¸å±¬å…­å¤§é¡', 'category', 'Main Category'])).trim();
                let txt = (getValue(r, ['ç¶“æ–‡å…§å®¹ (Content)', 'ç¶“æ–‡å…§å®¹', 'content', 'text'])).trim();
                let rawCat = (getValue(r, ['åˆ†é¡ (Category)', 'åˆ†é¡', 'category', 'title'])).trim(); 
                let ref = (getValue(r, ['å‡ºè™• (Reference)', 'å‡ºè™•', 'reference', 'ref'])).trim();
                let kw = (getValue(r, ['é—œéµå­— (Keywords)', 'é—œéµå­—', 'keywords'])).trim();
                if (!txt) return null;
                if (!ref) {
                     const match = txt.match(/[\(\ï¼ˆ](.*?)[\)\ï¼‰]$/);
                     if (match) { ref = match[1]; txt = txt.substring(0, match.index).trim(); } 
                     else { ref = "è–ç¶“"; }
                }
                return { category: cat, originalCategory: rawCat || cat, keywords: kw ? kw.split(/[,ï¼Œ\s]+/) : [], text: txt, ref: ref };
            }).filter(item => item !== null);
            const count = firstAidDatabase.length;
            document.getElementById('hub-firstaid-status').innerText = `å·²è¼‰å…¥ ${count} å¸–`;
            document.getElementById('first-aid-count-display').innerText = `è—¥å±€åº«å­˜ï¼š${count} å¸–`;
        }

        window.openFirstAidKit = function() {
            document.getElementById('firstAidKitClosed').classList.add('hidden');
            document.getElementById('firstAidKitOpened').classList.remove('hidden');
            renderFirstAidCategories();
        }

        function renderFirstAidCategories() {
            const listContainer = document.getElementById('categoryList');
            if (!firstAidDatabase.length) { listContainer.innerHTML = '<div class="col-span-2 text-center text-red-400">è—¥å±€è£œè²¨ä¸­...</div>'; return; }
            const categories = [...new Set(firstAidDatabase.map(item => item.category))];
            listContainer.innerHTML = categories.map(cat => {
                const visual = categoryVisuals[cat] || { icon: 'fa-pills', bg: 'bg-gray-100', text: 'text-gray-700', border: 'border-gray-200' };
                return `<div class="medicine-item ${visual.bg} ${visual.border} group" onclick="renderSearchResults('${cat}', true)">
                        <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center ${visual.text} text-xl mb-2 shadow-sm group-hover:scale-110 transition-transform"><i class="fas ${visual.icon}"></i></div>
                        <span class="text-xs font-bold ${visual.text} tracking-wide">${cat}</span></div>`;
            }).join('');
        }

        window.renderSearchResults = function(query, isCategoryFilter = false, isTagFilter = false) {
            const resultsList = document.getElementById('searchResultsList');
            resultsList.innerHTML = '<div class="text-center py-10 text-gray-400"><i class="fas fa-spinner fa-spin"></i> æœå°‹ä¸­...</div>';
            setTimeout(() => {
                let matches = [];
                if (isTagFilter && customSearchLogic[query]) { matches = firstAidDatabase.filter(customSearchLogic[query]); } 
                else if (isCategoryFilter) { matches = firstAidDatabase.filter(item => item.category === query); } 
                else if (isTagFilter) { matches = firstAidDatabase.filter(item => item.keywords.some(k => k.includes(query)) || item.category.includes(query)); }
                if (matches.length === 0) { resultsList.innerHTML = '<div class="text-center py-10 text-gray-400">æ‰¾ä¸åˆ°ç›¸é—œè™•æ–¹ï¼Œè«‹è©¦è©¦å…¶ä»–åˆ†é¡ã€‚</div>'; return; }
                resultsList.innerHTML = matches.map(item => `
                    <div class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm mb-3">
                        <p class="text-gray-700 text-base leading-relaxed mb-3 font-medium text-justify">${item.text}</p>
                        <div class="flex justify-between items-center border-t border-gray-100 pt-3">
                            <div class="flex items-center flex-wrap gap-2">
                                <span class="text-xs text-orange-600 font-bold bg-orange-50 px-2 py-1 rounded">${item.ref}</span>
                                ${item.originalCategory ? `<span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded-full border border-gray-200">ğŸ’Š ${item.originalCategory}</span>` : ''}
                            </div>
                            <button class="text-gray-400 hover:text-red-800 transition-colors" onclick="copyText('${item.text} - ${item.ref}')"><i class="far fa-copy"></i></button>
                        </div>
                    </div>`).join('');
                resultsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }
        
        window.copyText = function(text) { copyTextToClipboard(text).then(() => showToast("å·²è¤‡è£½ç¶“æ–‡ï¼")); }
        function showToast(message) { const toast = document.getElementById("toast"); toast.innerText = message; toast.className = "toast show"; setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3500); }
        function copyTextToClipboard(text) { if (navigator.clipboard && navigator.clipboard.writeText) return navigator.clipboard.writeText(text); return new Promise((resolve, reject) => { const textArea = document.createElement("textarea"); textArea.value = text; textArea.style.position = "fixed"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { const successful = document.execCommand('copy'); if (successful) resolve(); else reject(); } catch (err) { reject(err); } document.body.removeChild(textArea); }); }
        
        async function captureAndShare(elementId, title, textFallback) {
            const element = document.getElementById(elementId); if (!element) { showToast("ç™¼ç”ŸéŒ¯èª¤"); return; }
            showToast("ğŸ“· æ­£åœ¨è£½ä½œç¥ç¦å¡ç‰‡...");
            try {
                const wasHidden = element.classList.contains('hidden');
                if(wasHidden && elementId !== 'prayerShareHidden') element.classList.remove('hidden');
                const canvas = await html2canvas(element, { scale: 3, backgroundColor: '#ffffff', useCORS: true, logging: false, ignoreElements: (node) => node.classList && (node.classList.contains('action-group') || node.classList.contains('back-btn') || node.classList.contains('share-btn-hide')) });
                canvas.toBlob(async (blob) => {
                    const file = new File([blob], "blessing_2026.png", { type: "image/png" });
                    if (navigator.share && navigator.canShare({ files: [file] })) { await navigator.share({ title: title, text: textFallback, files: [file] }); }
                    else { const link = document.createElement('a'); link.download = 'blessing_2026.png'; link.href = canvas.toDataURL(); link.click(); }
                }, 'image/png');
            } catch (err) { copyTextToClipboard(textFallback + "\n\nğŸ‘‰ " + window.location.href).then(() => showToast("å·²è¤‡è£½æ–‡å­—ï¼")); }
        }
        
        function shareVerse() { const verse = document.getElementById('verseText').innerText; if (verse === 'Loading...') return; captureAndShare('card-scratch', 'Jesus Vibes 2026', `âœ¨ æˆ‘çš„ 2026 æ–°æ˜¥ç¥ç¦ âœ¨\n\nã€Œ${verse}ã€`); }
        function shareResponse() { const text = document.getElementById('responseText').innerText; const ref = document.getElementById('responseRef').innerText; const title = document.getElementById('responseTitle').innerText; const song = document.getElementById('responseSong').innerText; document.getElementById('sharePokeTitle').innerText = title; document.getElementById('sharePokeRef').innerText = ref; document.getElementById('sharePokeText').innerText = text; document.getElementById('sharePokeSong').innerText = song; captureAndShare('pokeShareHidden', 'Jesus Vibes 2026', `ğŸŒ² çµ¦ä½ çš„æ©å…¸å›æ‡‰ ğŸŒ²\n\nã€${title}ã€‘\n${text}\n\nğŸ“– ${ref}\nğŸµ ${song}`); }
        function sharePrayerBook() { const title = document.getElementById('prayerBookTitle').innerText; const ref = document.getElementById('prayerBookRef').innerText; const text = document.getElementById('prayerBookFullContent').classList.contains('hidden') ? document.getElementById('prayerBookText').innerText : document.getElementById('prayerBookFullText').innerText; document.getElementById('sharePrayerTitle').innerText = title; document.getElementById('sharePrayerRef').innerText = ref; document.getElementById('sharePrayerText').innerText = text; const shareCard = document.getElementById('prayerShareHidden'); shareCard.style.opacity = '1'; captureAndShare('prayerShareHidden', 'Jesus Vibes 2026', `ğŸ•Šï¸ æˆ‘çš„ç¦±å‘Šå°æ™‚å…‰ ğŸ•Šï¸\n\nã€${title}ã€‘\n${ref}\n\n${text}\n\n- Amen -`).then(() => shareCard.style.opacity = '0'); }
        function shareSurvival() { const text = document.getElementById('survivalText').innerText; copyTextToClipboard(`ğŸ§¨ æ©Ÿæ™ºçš„éå¹´ç”Ÿæ´»\n\nA: ã€Œ${text}ã€`).then(() => showToast("å·²è¤‡è£½ï¼")); }

        function initStars() { const container = document.getElementById('stars-container'); if(!container) return; for (let i = 0; i < 20; i++) { const star = document.createElement('div'); star.classList.add('star'); star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 60}%`; const size = Math.random() * 8 + 4; star.style.width = `${size}px`; star.style.height = `${size}px`; star.style.animationDuration = `${Math.random() * 2 + 1}s`; star.style.animationDelay = `${Math.random() * 2}s`; container.appendChild(star); } }
        window.showFullVerse = function() {
            if(!currentVerseData) return;
            const verseTextDiv = document.getElementById('verseText'); const btn = document.getElementById('fullVerseBtn');
            if(btn.innerText.includes('å®Œæ•´')) { verseTextDiv.innerText = currentVerseData.full; btn.innerHTML = '<i class="fas fa-compress-arrows-alt mr-1"></i> é¡¯ç¤ºç²¾ç°¡ç¶“æ–‡'; } 
            else { verseTextDiv.innerText = currentVerseData.short; btn.innerHTML = '<i class="fas fa-book-open mr-1"></i> é¡¯ç¤ºå®Œæ•´ç¶“æ–‡'; }
        }

        /* --------------------------
            QUIZ LOGIC
            -------------------------- */
        let currentQuizData = [];
        let currentQuizIndex = 0;
        let quizScore = 0;
        let activeQuizType = '';
        let quizTimerInterval = null;
        let quizTimeLeft = 60;
        let quizHistory = [];

        window.startQuiz = function(quizKey, quizName) {
            activeQuizType = quizKey;
            currentQuizData = scholarDatabase[quizKey];
            
            if (!currentQuizData || currentQuizData.length === 0) {
                showToast("è€ƒå·é‹é€ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
                return;
            }
            
            // Randomize Question Pool
            currentQuizData = currentQuizData.sort(() => 0.5 - Math.random());
            currentQuizIndex = 0;
            quizScore = 0;
            quizHistory = []; // Reset history

            hideAllViews();
            views.quizView.classList.remove('hidden');
            views.quizView.classList.add('fade-in');
            
            // Reset UI
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');
            document.querySelector('.nav-title').innerText = quizName || "æ¸¬é©—é€²è¡Œä¸­";
            document.getElementById('quiz-review-list').classList.add('hidden'); // Hide review initially
            
            // Mode Specific Setup
            if (activeQuizType === 'quiz1') {
                // Time Attack Mode
                document.getElementById('quiz-progress').classList.add('hidden');
                document.getElementById('quiz-timer').classList.remove('hidden');
                document.getElementById('quiz-timer').innerText = "60";
                
                quizTimeLeft = 60;
                clearInterval(quizTimerInterval);
                quizTimerInterval = setInterval(() => {
                    quizTimeLeft--;
                    document.getElementById('quiz-timer').innerText = quizTimeLeft;
                    if(quizTimeLeft <= 10) document.getElementById('quiz-timer').classList.add('animate-pulse');
                    else document.getElementById('quiz-timer').classList.remove('animate-pulse');

                    if (quizTimeLeft <= 0) {
                        clearInterval(quizTimerInterval);
                        showQuizResult();
                    }
                }, 1000);
            } else {
                // Standard Mode
                document.getElementById('quiz-progress').classList.remove('hidden');
                document.getElementById('quiz-timer').classList.add('hidden');
                currentQuizData = currentQuizData.slice(0, 10); // Limit to 10 questions for non-exam mode
            }
            
            renderQuestion();
        };

        function renderQuestion() {
            // Check index for Standard Mode
            if (activeQuizType !== 'quiz1' && currentQuizIndex >= currentQuizData.length) {
                showQuizResult();
                return;
            }
            
            // For Time Attack, if we run out of unique questions, reshuffle? 
            // Or just check bounds. The pool is usually large enough. 
            // If index overflows in exam mode, wrap around.
            let qIndex = currentQuizIndex;
            if (activeQuizType === 'quiz1') {
                 qIndex = currentQuizIndex % currentQuizData.length;
            }

            const q = currentQuizData[qIndex];
            
            if (activeQuizType !== 'quiz1') {
                document.getElementById('quiz-progress').innerText = `${currentQuizIndex + 1} / 10`;
            }
            
            document.getElementById('quiz-category-tag').innerText = q.category || 'ç¶œåˆ';
            document.getElementById('quiz-question').innerText = q.question;
            
            // Render Options
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            const labels = ['A', 'B', 'C', 'D'];
            q.options.forEach((opt, idx) => {
                if(!opt) return;
                const btn = document.createElement('div');
                btn.className = 'quiz-option';
                btn.onclick = () => checkAnswer(idx, btn);
                btn.innerHTML = `
                    <div class="quiz-circle">${labels[idx]}</div>
                    <span class="font-bold text-gray-700 text-sm flex-1">${opt}</span>
                `;
                optionsContainer.appendChild(btn);
            });

            // Hide Feedback
            document.getElementById('quiz-feedback').classList.add('hidden');
            if (activeQuizType !== 'quiz1') {
                document.getElementById('next-q-btn').innerText = (currentQuizIndex === 9) ? 'æŸ¥çœ‹æˆç¸¾' : 'ä¸‹ä¸€é¡Œ';
            }
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (document.querySelector('.quiz-option.selected-correct') || document.querySelector('.quiz-option.selected-wrong')) return;

            let qIndex = currentQuizIndex;
            if (activeQuizType === 'quiz1') qIndex = currentQuizIndex % currentQuizData.length;
            
            const q = currentQuizData[qIndex];
            const labels = ['A', 'B', 'C', 'D'];
            const selectedLabel = labels[selectedIndex];
            const selectedText = (q.options[selectedIndex] || '').trim();
            
            let correctLabel = (q.answer || '').trim(); 

            let isCorrect = (selectedLabel === correctLabel);

            if (!isCorrect) {
                 const normSelectedText = normalizeTextForComparison(selectedText);
                 const normCorrectLabel = normalizeTextForComparison(correctLabel);
                 if (normSelectedText && normCorrectLabel && normSelectedText === normCorrectLabel) {
                     isCorrect = true;
                     correctLabel = selectedLabel; 
                 }
            }

            // Record History
            quizHistory.push({
                q: q.question,
                userAns: selectedText,
                correctAns: isCorrect ? selectedText : q.options[labels.indexOf(correctLabel)] || correctLabel, // Try to find text of correct label
                isCorrect: isCorrect
            });

            if (isCorrect) {
                btnElement.classList.add('selected-correct');
                quizScore += (activeQuizType === 'quiz1' ? 1 : 10); // 1 point per Q in exam, 10 pts in standard
            } else {
                btnElement.classList.add('selected-wrong');
                const options = document.querySelectorAll('.quiz-option');
                options.forEach((opt, idx) => {
                    if (labels[idx] === correctLabel) opt.classList.add('selected-correct');
                });
            }

            // Mode Specific Post-Answer Logic
            if (activeQuizType === 'quiz1') {
                // Time Attack: Auto Advance after short delay
                setTimeout(() => {
                    currentQuizIndex++;
                    renderQuestion();
                }, 500); // 0.5s delay
            } else {
                // Standard Mode: Show Feedback Button
                // Get Full Correct Answer Text
                const correctIndex = labels.indexOf(correctLabel);
                const correctOptionText = q.options[correctIndex] || '';
                const fullAnswerString = `${correctLabel}. ${correctOptionText}`;
                
                showFeedback(isCorrect, q.note, fullAnswerString);
            }
        }

        function showFeedback(isCorrect, note, fullCorrectAnswer) {
            const feedbackEl = document.getElementById('quiz-feedback');
            const iconEl = document.getElementById('feedback-icon');
            const titleEl = document.getElementById('feedback-title');
            const contentEl = document.getElementById('feedback-content');

            feedbackEl.classList.remove('hidden');
            feedbackEl.className = `mt-4 p-4 rounded-xl text-left border-2 ${isCorrect ? 'bg-green-50 border-green-100' : 'bg-red-50 border-red-100'}`;
            
            iconEl.className = `w-6 h-6 rounded-full flex items-center justify-center text-white text-xs ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
            iconEl.innerHTML = isCorrect ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
            
            titleEl.innerHTML = isCorrect ? 'ç­”å°äº†ï¼' : 'ç­”éŒ¯äº†ï¼';
            titleEl.className = `font-bold text-sm ${isCorrect ? 'text-green-700' : 'text-red-700'}`;
            
            // æ§‹å»ºé¡¯ç¤ºå…§å®¹ï¼šæ­£ç¢ºç­”æ¡ˆ + è§£æ
            let htmlContent = `<div class="mt-2 font-bold text-base text-gray-800">æ­£ç¢ºç­”æ¡ˆï¼š<span class="text-[#006064]">${fullCorrectAnswer}</span></div>`;
            
            if (note) {
                htmlContent += `<div class="mt-2 text-xs text-gray-500 border-t border-gray-200 pt-2 leading-relaxed">ğŸ’¡ ${note}</div>`;
            }
            
            contentEl.innerHTML = htmlContent;
            
            setTimeout(() => {
                feedbackEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        window.nextQuestion = function() {
            currentQuizIndex++;
            renderQuestion();
        }

        function showQuizResult() {
            clearInterval(quizTimerInterval);
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            const scoreEl = document.getElementById('final-score');
            if (activeQuizType === 'quiz1') {
                scoreEl.innerText = `${quizScore} é¡Œ`; // Show count
                renderReviewList();
            } else {
                scoreEl.innerText = quizScore; // Show points
                document.getElementById('quiz-review-list').classList.add('hidden'); // Hide review for standard mode (optional)
            }
        }

        function renderReviewList() {
            const list = document.getElementById('quiz-review-list');
            list.classList.remove('hidden');
            list.innerHTML = `<h4 class="text-sm font-bold text-gray-500 mb-3 border-b pb-2">ğŸ“œ è€ƒå·æª¢è¨</h4>`;
            
            quizHistory.forEach((item, i) => {
                list.innerHTML += `
                    <div class="quiz-review-item">
                        <div class="quiz-review-q">${i+1}. ${item.q}</div>
                        <div class="quiz-review-ans">
                            <div><span class="ans-label">ä½ çš„ç­”æ¡ˆ:</span> <span class="ans-text ${item.isCorrect ? 'correct' : 'wrong'}">${item.userAns}</span></div>
                        </div>
                        ${!item.isCorrect ? `<div class="quiz-review-ans mt-1"><div><span class="ans-label">æ­£ç¢ºç­”æ¡ˆ:</span> <span class="ans-text correct">${item.correctAns}</span></div></div>` : ''}
                    </div>
                `;
            });
        }

        window.restartQuiz = function() {
            startQuiz(activeQuizType, document.querySelector('.nav-title').innerText);
        }

        /* --------------------------
            FRUIT GAME LOGIC
            -------------------------- */
        let fruitGameScore = 0;
        let fruitGameTime = 60;
        let fruitGameActive = false;
        let fruitInterval = null;
        let timerInterval = null;
        
        // Definition of fruits (Good vs Bad pairs)
        const fruitsData = [
            { id: 1, type: 'good', icon: 'fa-heart', color: 'text-red-500', name: 'ä»æ„›' },
            { id: 1, type: 'bad', icon: 'fa-heart-crack', color: 'text-red-600', name: 'ç ´ç¢' },
            
            { id: 2, type: 'good', icon: 'fa-face-laugh-beam', color: 'text-yellow-400', name: 'å–œæ¨‚' },
            { id: 2, type: 'bad', icon: 'fa-face-angry', color: 'text-yellow-500', name: 'ç”Ÿæ°£' },
            
            { id: 3, type: 'good', icon: 'fa-dove', color: 'text-blue-400', name: 'å’Œå¹³' },
            { id: 3, type: 'bad', icon: 'fa-crow', color: 'text-blue-500', name: 'ç´›çˆ­' }, // using crow as dark bird
            
            { id: 4, type: 'good', icon: 'fa-hourglass-half', color: 'text-purple-400', name: 'å¿è€' },
            { id: 4, type: 'bad', icon: 'fa-bomb', color: 'text-purple-600', name: 'æš´èº' },
            
            { id: 5, type: 'good', icon: 'fa-hand-holding-heart', color: 'text-pink-400', name: 'æ©æ…ˆ' },
            { id: 5, type: 'bad', icon: 'fa-hand-middle-finger', color: 'text-pink-600', name: 'åˆ»è–„' }, // Not in FA free, use fist
            { id: 5, type: 'bad', icon: 'fa-hand-fist', color: 'text-pink-600', name: 'æš´åŠ›' },

            { id: 6, type: 'good', icon: 'fa-star', color: 'text-orange-400', name: 'è‰¯å–„' },
            { id: 6, type: 'bad', icon: 'fa-virus', color: 'text-orange-500', name: 'é‚ªæƒ¡' },
            
            { id: 7, type: 'good', icon: 'fa-handshake', color: 'text-teal-400', name: 'ä¿¡å¯¦' },
            { id: 7, type: 'bad', icon: 'fa-mask', color: 'text-teal-600', name: 'è™›å‡' },
            
            { id: 8, type: 'good', icon: 'fa-feather', color: 'text-gray-400', name: 'æº«æŸ”' },
            { id: 8, type: 'bad', icon: 'fa-gavel', color: 'text-gray-600', name: 'å®šç½ª' },
            
            { id: 9, type: 'good', icon: 'fa-user-shield', color: 'text-green-500', name: 'ç¯€åˆ¶' },
            { id: 9, type: 'bad', icon: 'fa-pizza-slice', color: 'text-green-600', name: 'æ”¾ç¸±' }
        ];

        window.startFruitGame = function() {
            hideAllViews();
            views.fruitGame.classList.remove('hidden');
            views.fruitGame.classList.add('fade-in');
            homeHeader.style.display = 'none'; 
            innerNavBar.style.display = 'flex'; 
            document.querySelector('.nav-title').innerText = "è–éˆæœå­å¤§ä½œæˆ°";
            
            // Reset UI
            document.getElementById('fruit-start-overlay').classList.remove('hidden');
            document.getElementById('fruit-gameover-overlay').classList.add('hidden');
            document.getElementById('fruit-score').innerText = '0';
            document.getElementById('fruit-timer').innerText = '60';
            document.getElementById('fruit-game-area').innerHTML = `
                <div id="fruit-start-overlay" class="absolute inset-0 bg-black/60 z-30 flex flex-col items-center justify-center text-white p-6 text-center">
                    <div class="w-20 h-20 bg-[#FFCCBC] rounded-full flex items-center justify-center text-4xl mb-4 animate-bounce text-[#D84315] border-4 border-white">
                        <i class="fas fa-apple-alt"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-2 title-font text-[#FFAB91]">è–éˆæœå­å¤§ä½œæˆ°</h2>
                    <p class="text-sm opacity-90 mb-6 leading-relaxed">
                        åœ¨ 60 ç§’å…§æ”¶é›† 20 é¡†è–éˆæœå­ï¼<br>
                        <span class="text-yellow-300 font-bold">å°å¿ƒï¼</span> é»åˆ°å£æœå­æœƒæ‰£ 5 ç§’å–”ï¼
                    </p>
                    <button onclick="startGameLoop()" class="bg-[#D84315] text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg hover:scale-105 transition-transform">
                        <i class="fas fa-play mr-2"></i> é–‹å§‹æŒ‘æˆ°
                    </button>
                </div>
            `; // Re-inject start overlay to be sure
        }

        window.startGameLoop = function() {
            document.getElementById('fruit-start-overlay').classList.add('hidden');
            fruitGameScore = 0;
            fruitGameTime = 60;
            fruitGameActive = true;
            document.getElementById('fruit-score').innerText = '0';
            document.getElementById('fruit-timer').innerText = '60';
            
            // Timer Loop
            timerInterval = setInterval(() => {
                if(!fruitGameActive) return;
                fruitGameTime--;
                document.getElementById('fruit-timer').innerText = fruitGameTime;
                if(fruitGameTime <= 10) document.getElementById('fruit-timer').classList.add('text-red-600', 'animate-pulse');
                else document.getElementById('fruit-timer').classList.remove('text-red-600', 'animate-pulse');
                
                if(fruitGameTime <= 0) {
                    endFruitGame();
                }
            }, 1000);

            // Spawner Loop
            fruitInterval = setInterval(spawnFruit, 700); // Spawn every 0.7s
        }

        function spawnFruit() {
            if(!fruitGameActive) return;
            const gameArea = document.getElementById('fruit-game-area');
            const fruitData = fruitsData[Math.floor(Math.random() * fruitsData.length)];
            
            const fruit = document.createElement('div');
            fruit.className = `fruit-item bg-white ${fruitData.color}`;
            
            // Updated innerHTML to include text
            fruit.innerHTML = `
                <div class="flex flex-col items-center justify-center pointer-events-none w-full h-full">
                    <i class="fas ${fruitData.icon} text-2xl mb-0.5"></i>
                    <span class="text-[10px] font-bold leading-none">${fruitData.name}</span>
                </div>
            `;
            
            // Random Position
            const startX = Math.random() * (gameArea.offsetWidth - 72); // Adjusted for wider fruit
            fruit.style.left = `${startX}px`;
            
            // Random Fall Speed (3.5s to 6.5s) - Slower speed
            const duration = 3.5 + Math.random() * 3;
            fruit.style.animationDuration = `${duration}s`;
            
            // Click Handler
            fruit.onmousedown = (e) => handleFruitClick(e, fruit, fruitData);
            fruit.ontouchstart = (e) => handleFruitClick(e, fruit, fruitData);
            
            // Cleanup after animation
            fruit.addEventListener('animationend', () => {
                if(fruit.parentNode) fruit.remove();
            });

            gameArea.appendChild(fruit);
        }

        function handleFruitClick(e, el, data) {
            if(!fruitGameActive) return;
            e.preventDefault();
            e.stopPropagation();
            
            if(el.classList.contains('clicked')) return;
            el.classList.add('clicked');
            
            // Visual Feedback
            el.style.animation = 'none'; // Stop falling
            el.classList.add('fruit-pop'); // Pop animation
            
            if(data.type === 'good') {
                fruitGameScore++;
                document.getElementById('fruit-score').innerText = fruitGameScore;
                el.style.backgroundColor = '#E8F5E9'; // Light Green bg
                // Removed immediate win condition
            } else {
                // Bad Fruit
                fruitGameTime -= 5;
                showToast("âš ï¸ è¸©åˆ°åœ°é›·ï¼æ™‚é–“ -5ç§’");
                document.getElementById('fruit-timer').innerText = fruitGameTime;
                document.getElementById('fruit-timer').classList.add('text-red-600');
                if(navigator.vibrate) navigator.vibrate(200);
                el.style.backgroundColor = '#FFEBEE'; // Light Red bg
            }
            
            setTimeout(() => { if(el.parentNode) el.remove(); }, 300);
        }

        function endFruitGame() {
            fruitGameActive = false;
            clearInterval(fruitInterval);
            clearInterval(timerInterval);
            
            const area = document.getElementById('fruit-game-area');
            const overlay = document.createElement('div');
            overlay.id = "fruit-gameover-overlay";
            overlay.className = "absolute inset-0 bg-black/80 z-30 flex flex-col items-center justify-center text-white p-6 text-center fade-in";
            
            if(fruitGameScore >= 20) {
                // Win
                overlay.innerHTML = `
                    <div class="w-20 h-20 bg-yellow-400 rounded-full flex items-center justify-center text-4xl mb-4 animate-bounce border-4 border-white text-red-600 shadow-xl">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-2 text-yellow-300">æ­å–œéé—œï¼</h2>
                    <p class="text-sm opacity-90 mb-6 font-bold">ä½ æ”¶é›†äº† ${fruitGameScore} é¡†è–éˆæœå­ï¼<br>å¤ªæ£’äº†ï¼</p>
                    <button onclick="showHeavenlyEnvelope()" class="bg-red-600 text-yellow-100 px-8 py-3 rounded-full font-bold text-lg shadow-lg animate-pulse mb-3 border-2 border-yellow-400">
                        <i class="fas fa-gift mr-2"></i> é ˜å–å¤©åœ‹å¤§ç´…åŒ…
                    </button>
                    <button onclick="exitFruitGame()" class="text-sm text-gray-400 underline mt-2">å›éŠæˆ²å¤§å»³</button>
                `;
            } else {
                // Fail
                overlay.innerHTML = `
                    <i class="fas fa-hourglass-end text-5xl text-gray-400 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">æ™‚é–“åˆ°ï¼</h2>
                    <p class="text-sm opacity-80 mb-6">ç›®å‰å¾—åˆ†ï¼š${fruitGameScore}/20<br>å·®ä¸€é»é»å°±æˆåŠŸäº†ï¼Œå†è©¦ä¸€æ¬¡å§ï¼</p>
                    <button onclick="resetFruitGame()" class="bg-white text-[#D84315] px-6 py-2 rounded-full font-bold shadow-lg mb-3">
                        <i class="fas fa-redo mr-2"></i> å†æ¥å†å²
                    </button>
                    <button onclick="exitFruitGame()" class="text-sm text-gray-400 underline">æ”¾æ£„é›¢é–‹</button>
                `;
            }
            area.appendChild(overlay);
        }

        window.resetFruitGame = function() {
            // Clear existing fruits
            const fruits = document.querySelectorAll('.fruit-item');
            fruits.forEach(f => f.remove());
            // Remove overlays
            const overlays = document.querySelectorAll('#fruit-gameover-overlay');
            overlays.forEach(o => o.remove());
            
            startGameLoop();
        }

        window.exitFruitGame = function() {
            fruitGameActive = false;
            clearInterval(fruitInterval);
            clearInterval(timerInterval);
            showGameHub();
        }

        /* --------------------------
            MEMORY GAME LOGIC (3 Levels)
            -------------------------- */
        let memoryLevel = 1;
        let memoryTime = 30;
        let memoryTimer = null;
        let memoryFlipped = [];
        let memoryMatched = 0;
        let memoryTotalPairs = 0;
        let memoryActive = false;

        window.initMemoryGame = function() {
            hideAllViews();
            views.memoryGame.classList.remove('hidden');
            views.memoryGame.classList.add('fade-in');
            homeHeader.style.display = 'none';
            innerNavBar.style.display = 'flex';
            document.querySelector('.nav-title').innerText = "è…¦åŠ›å…¨é–‹ç¿»ç¿»æ¨‚";
            
            memoryLevel = 1;
            startMemoryLevel(1);
        }

        function startMemoryLevel(level) {
            memoryLevel = level;
            memoryFlipped = [];
            memoryMatched = 0;
            memoryActive = false; // Wait for user to start or simple delay? Let's auto start with overlay
            
            let cardCount, timeLimit;
            if(level === 1) { cardCount = 8; timeLimit = 30; }
            else if(level === 2) { cardCount = 16; timeLimit = 60; }
            else { cardCount = 32; timeLimit = 120; }
            
            memoryTotalPairs = cardCount / 2;
            memoryTime = timeLimit;
            
            // Show Overlay
            const overlay = document.getElementById('memory-overlay');
            const content = document.getElementById('memory-overlay-content');
            overlay.classList.remove('hidden');
            content.innerHTML = `
                <div class="text-4xl mb-4">ğŸ§ </div>
                <h2 class="text-3xl font-bold mb-2 text-[#FFAB91]">ç¬¬ ${level} é—œ</h2>
                <p class="text-sm opacity-90 mb-6">
                    ${cardCount} å¼µç‰Œ ( ${memoryTotalPairs} å° )<br>
                    é™æ™‚ ${timeLimit} ç§’
                </p>
                <button onclick="runMemoryLevel()" class="bg-[#D84315] text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg hover:scale-105 transition-transform">
                    <i class="fas fa-play mr-2"></i> é–‹å§‹è¨˜æ†¶
                </button>
            `;
            
            // Prepare Grid
            const grid = document.getElementById('memory-game-grid');
            grid.innerHTML = '';
            
            // Select random books
            const shuffledBooks = BIBLE_BOOKS.sort(() => 0.5 - Math.random()).slice(0, memoryTotalPairs);
            const gameCards = [...shuffledBooks, ...shuffledBooks].sort(() => 0.5 - Math.random());
            
            // Set grid cols based on level
            if(level === 1) grid.className = "grid grid-cols-4 gap-2 w-full max-w-sm mx-auto";
            else if(level === 2) grid.className = "grid grid-cols-4 gap-2 w-full max-w-sm mx-auto";
            else grid.className = "grid grid-cols-4 gap-2 w-full max-w-md mx-auto mb-20"; // Add margin for scroll
            
            // Render Cards
            gameCards.forEach((book, index) => {
                const card = document.createElement('div');
                card.className = 'flip-card aspect-[3/4]'; // Aspect ratio for card shape
                card.innerHTML = `
                    <div class="flip-card-inner" id="card-${index}" onclick="flipCard(${index}, '${book}')">
                        <div class="flip-card-front"><i class="fas fa-book-bible"></i></div>
                        <div class="flip-card-back">${book}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            document.getElementById('memory-level-display').innerText = `${level}/3`;
            document.getElementById('memory-timer').innerText = timeLimit;
        }

        window.runMemoryLevel = function() {
            document.getElementById('memory-overlay').classList.add('hidden');
            memoryActive = true;
            
            clearInterval(memoryTimer);
            memoryTimer = setInterval(() => {
                if(!memoryActive) return;
                memoryTime--;
                document.getElementById('memory-timer').innerText = memoryTime;
                
                if(memoryTime <= 10) document.getElementById('memory-timer').classList.add('text-red-600', 'animate-pulse');
                else document.getElementById('memory-timer').classList.remove('text-red-600', 'animate-pulse');
                
                if(memoryTime <= 0) {
                    endMemoryGame(false);
                }
            }, 1000);
        }

        window.flipCard = function(index, book) {
            if(!memoryActive) return;
            const cardInner = document.getElementById(`card-${index}`);
            
            // Prevent flipping matched or currently flipped cards, or if 2 cards already flipped
            if(cardInner.parentElement.classList.contains('flipped') || 
               cardInner.querySelector('.flip-card-back').classList.contains('matched') ||
               memoryFlipped.length >= 2) return;
               
            // Flip it
            cardInner.parentElement.classList.add('flipped');
            memoryFlipped.push({ index, book });
            
            if(memoryFlipped.length === 2) {
                checkMemoryMatch();
            }
        }

        function checkMemoryMatch() {
            const [card1, card2] = memoryFlipped;
            
            if(card1.book === card2.book) {
                // Match
                memoryMatched++;
                document.getElementById(`card-${card1.index}`).querySelector('.flip-card-back').classList.add('matched');
                document.getElementById(`card-${card2.index}`).querySelector('.flip-card-back').classList.add('matched');
                memoryFlipped = [];
                
                if(memoryMatched === memoryTotalPairs) {
                    endMemoryGame(true);
                }
            } else {
                // No Match
                setTimeout(() => {
                    document.getElementById(`card-${card1.index}`).parentElement.classList.remove('flipped');
                    document.getElementById(`card-${card2.index}`).parentElement.classList.remove('flipped');
                    memoryFlipped = [];
                }, 1000);
            }
        }

        function endMemoryGame(win) {
            memoryActive = false;
            clearInterval(memoryTimer);
            
            const overlay = document.getElementById('memory-overlay');
            const content = document.getElementById('memory-overlay-content');
            overlay.classList.remove('hidden');
            
            if(win) {
                if(memoryLevel < 3) {
                    content.innerHTML = `
                        <div class="text-4xl mb-4">ğŸŒŸ</div>
                        <h2 class="text-3xl font-bold mb-2 text-green-400">é—–é—œæˆåŠŸï¼</h2>
                        <p class="text-sm opacity-90 mb-6">æº–å‚™é€²å…¥ä¸‹ä¸€é—œæŒ‘æˆ°ï¼</p>
                        <button onclick="startMemoryLevel(${memoryLevel + 1})" class="bg-green-600 text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg">
                            <i class="fas fa-arrow-right mr-2"></i> ä¸‹ä¸€é—œ
                        </button>
                    `;
                } else {
                    content.innerHTML = `
                        <div class="text-4xl mb-4">ğŸ†</div>
                        <h2 class="text-3xl font-bold mb-2 text-yellow-400">å®Œå…¨åˆ¶éœ¸ï¼</h2>
                        <p class="text-sm opacity-90 mb-6">å¤ªå²å®³äº†ï¼å¿«å»é ˜å–ä½ çš„çè³ï¼</p>
                        <button onclick="showHeavenlyEnvelope()" class="bg-yellow-500 text-red-900 px-8 py-3 rounded-full font-bold text-lg shadow-lg animate-bounce">
                            <i class="fas fa-gift mr-2"></i> é ˜å–å¤©åœ‹å¤§ç´…åŒ…
                        </button>
                    `;
                }
            } else {
                content.innerHTML = `
                    <div class="text-4xl mb-4">â³</div>
                    <h2 class="text-3xl font-bold mb-2">æ™‚é–“åˆ°ï¼</h2>
                    <p class="text-sm opacity-90 mb-6">åˆ¥æ°£é¤’ï¼Œå†è©¦ä¸€æ¬¡å§ï¼</p>
                    <button onclick="startMemoryLevel(${memoryLevel})" class="bg-white text-gray-800 px-6 py-2 rounded-full font-bold shadow-lg mb-3">
                        <i class="fas fa-redo mr-2"></i> é‡ç©æœ¬é—œ
                    </button>
                    <div class="mt-2">
                        <button onclick="exitMemoryGame()" class="text-sm underline">æ”¾æ£„é›¢é–‹</button>
                    </div>
                `;
            }
        }

        window.exitMemoryGame = function() {
            memoryActive = false;
            clearInterval(memoryTimer);
            showGameHub();
        }

        /* --------------------------
            SOLITAIRE GAME LOGIC
            -------------------------- */
        let solDeck = [];
        let solColumns = [[], [], [], []];
        let solStock = [];
        let solHolding = []; // The 3 cards currently visible for play
        let solActiveCard = null; // Currently selected card from HOLDING
        let solCompletedCols = 0;
        let solColumnStates = [false, false, false, false];
        
        const SOL_COLORS = ['red', 'blue', 'green', 'gold'];

        window.initMiracleSolitaire = function() {
            hideAllViews();
            views.solitaireGame.classList.remove('hidden');
            views.solitaireGame.classList.add('fade-in');
            homeHeader.style.display = 'none';
            innerNavBar.style.display = 'flex';
            document.querySelector('.nav-title').innerText = "ç¥è¹Ÿå¥‡äº‹é€£é€£çœ‹";
            
            document.getElementById('solitaire-start-overlay').classList.remove('hidden');
        }

        window.startSolitaireGame = function() {
            document.getElementById('solitaire-start-overlay').classList.add('hidden');
            solColumns = [[], [], [], []];
            solColumnStates = [false, false, false, false];
            solStock = [];
            solHolding = [];
            solCompletedCols = 0;
            createSolitaireDeck();
            
            renderSolitaireBoard();
        }

        function createSolitaireDeck() {
            solDeck = [];
            // Create 1-12 for each color
            SOL_COLORS.forEach(color => {
                for(let i=1; i<=12; i++) {
                    solDeck.push({
                        id: `card-${color}-${i}`,
                        color: color,
                        rank: i,
                        text: MIRACLES_LIST[i-1]
                    });
                }
            });
            // Add Resurrection Card (Rank 13)
            solDeck.push({
                id: 'card-resurrection',
                color: 'resurrection',
                rank: 13,
                text: 'å¾©æ´»å¾—å‹\nğŸ‘‘'
            });
             // Add Ghost Card (Rank 0)
            solDeck.push({
                id: 'card-ghost',
                color: 'joker',
                rank: 0,
                text: 'æ’’æ—¦ç ´å£\nğŸ‘»'
            });
            
            // Shuffle
            solDeck.sort(() => 0.5 - Math.random());
            
            // All goes to stock pile (face down)
            solStock = [...solDeck];
        }

        window.dealSolitaireCards = function() {
            // Check if stock is empty
            if(solStock.length === 0 && solHolding.length === 0) {
                 showSolMessage("æ²’æœ‰ç‰Œäº†ï¼");
                 return;
            }

            // Recycle current holding cards to bottom of stock
            if (solHolding.length > 0) {
                // Put them back at the bottom of the deck (or random insertion?)
                // Standard practice: recycle to bottom
                solStock = [...solHolding, ...solStock]; 
                solHolding = [];
            }
            
            // Draw up to 3 cards
            let drawCount = Math.min(3, solStock.length);
            for(let i=0; i<drawCount; i++) {
                solHolding.push(solStock.pop()); // Take from "top" (end of array)
            }
            
            // Deselect any active card
            solActiveCard = null;
            
            renderSolitaireBoard();
        }

        function renderSolitaireBoard() {
            // Update Deck Count
            document.getElementById('sol-deck-count').innerText = solStock.length;
            
            // Render Holding Area
            const holdingDiv = document.getElementById('sol-holding');
            holdingDiv.innerHTML = '';
            solHolding.forEach((card, idx) => {
                const cardEl = document.createElement('div');
                cardEl.className = `sol-card sol-card-holding sol-card-${card.color} ${solActiveCard && solActiveCard.id === card.id ? 'selected' : ''}`;
                cardEl.onclick = () => selectHoldingCard(card);
                
                let rankDisplay = card.rank;
                if(card.rank === 13) rankDisplay = 'ğŸ‘‘';
                if(card.rank === 0) rankDisplay = 'ğŸ‘»';
                
                cardEl.innerHTML = `
                    <div class="sol-number">${rankDisplay}</div>
                    <div class="sol-text text-[9px] leading-tight">${card.text}</div>
                `;
                holdingDiv.appendChild(cardEl);
            });

            // Render Board Columns
            const board = document.getElementById('solitaire-board');
            board.innerHTML = '';
            
            solColumns.forEach((col, colIndex) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'sol-col';
                // Add click listener to column to receive card
                colDiv.onclick = () => handleColumnClick(colIndex);
                
                // If column is completed, add class
                if (solColumnStates[colIndex]) {
                    colDiv.classList.add('completed');
                } else {
                    // Render placeholder if empty and not completed
                    if (col.length === 0) {
                       colDiv.innerHTML = `<div class="absolute inset-0 flex items-center justify-center text-white/20 text-4xl font-bold border-2 border-dashed border-white/20 rounded-lg pointer-events-none">${colIndex + 1}</div>`;
                    }
    
                    col.forEach((card, cardIndex) => {
                        const cardDiv = document.createElement('div');
                        let rankDisplay = card.rank;
                        
                        cardDiv.className = `sol-card sol-card-${card.color}`;
                        // Stack spacing
                        cardDiv.style.top = `${cardIndex * 28}px`; 
                        cardDiv.style.zIndex = cardIndex;
                        
                        cardDiv.innerHTML = `
                            <div class="sol-number">${rankDisplay}</div>
                            <div class="sol-text">${card.text}</div>
                        `;
                        colDiv.appendChild(cardDiv);
                    });
                }
                
                board.appendChild(colDiv);
            });
            
            // Check Win
            if(solCompletedCols >= 4) { // 4 Colors
                setTimeout(showHeavenlyEnvelope, 1000);
            }
        }

        function selectHoldingCard(card) {
            if (solActiveCard && solActiveCard.id === card.id) {
                solActiveCard = null; // Deselect
            } else {
                solActiveCard = card;
            }
            renderSolitaireBoard();
        }

        function handleColumnClick(colIndex) {
            // Check if completed
            if (solColumnStates[colIndex]) return;

            if (!solActiveCard) return; // No card selected to move

            const targetCol = solColumns[colIndex];
            const topCard = targetCol.length > 0 ? targetCol[targetCol.length - 1] : null;
            
            // --- GHOST CARD LOGIC ---
            if (solActiveCard.rank === 0) {
                // Ghost Card played on ANY column
                showSolMessage("ğŸ‘» å“å‘€ï¼é¬¼ç‰Œç‚¸æ‰äº†é€™ä¸€åˆ—ï¼");
                
                // Return all cards in this column to stock (bottom)
                // Note: We need to shuffle them back in? Prompt says "å›åˆ°ç‰Œåº«". Usually shuffle is implied or put at bottom.
                // Let's put at bottom for simplicity.
                if (targetCol.length > 0) {
                     solStock = [...targetCol, ...solStock];
                     solColumns[colIndex] = []; // Clear column
                }
                
                // The Ghost card itself also goes back to stock? Or is consumed?
                // "è‹¥ä¸å°å¿ƒå°‡é¬¼ç‰Œæ”¾åˆ°ä»»ä½•ä¸€åˆ—ï¼Œå‰‡è©²åˆ—å·²æ’åˆ—çš„ç‰Œå°‡å…¨éƒ¨å›åˆ°ç‰Œåº«" -> Implicitly ghost goes away or stays?
                // Usually bad cards are traps. Let's put Ghost back into stock to haunt again.
                solStock.unshift(solActiveCard); // Put ghost at 'bottom' (start of array is bottom for pop?) No, pop takes from end. unshift adds to start.
                // Wait, pop() takes from end. So unshift() puts at "bottom" of deck.
                
                // Remove from holding
                removeActiveCardFromHolding();
                solActiveCard = null;
                renderSolitaireBoard();
                return;
            }

            // --- RESURRECTION CARD LOGIC ---
            if (solActiveCard.rank === 13) {
                 // Must play on a column with at least 1 card to know the color
                 // Prompt: "å¾©æ´»èƒ½å°‡è®“è©²åˆ—ç›´æ¥å®Œæˆ"
                 // If column is empty, we don't know which color to complete.
                 
                 if (targetCol.length === 0) {
                     showSolMessage("âŒ éœ€å…ˆæ”¾ç½®ä¸€å¼µç‰Œç¢ºèªé¡è‰²ï¼");
                     return;
                 }
                 
                 // Complete this column!
                 showSolMessage("ğŸ‘‘ å¾©æ´»å¤§èƒ½ï¼è©²åˆ—å®Œæˆï¼");
                 
                 // Mark column as completed
                 solColumnStates[colIndex] = true;
                 solCompletedCols++;
                 
                 // Remove Resurrection card (Consumed)
                 removeActiveCardFromHolding();
                 solActiveCard = null;
                 
                 // Filter out remaining cards of this color from Deck and Holding?
                 // To prevent confusion, we should probably just leave them. They become junk.
                 // Or we can leave a visual marker "DONE".
                 // For simplicity: just score++.
                 
                 renderSolitaireBoard();
                 return;
            }

            // --- NORMAL CARD LOGIC ---
            let isValid = false;

            if (targetCol.length === 0) {
                // Empty column: Must start with Rank 1
                if (solActiveCard.rank === 1) {
                    isValid = true;
                } else {
                    showSolMessage("âŒ å¿…é ˆå¾ 1 é–‹å§‹ï¼");
                }
            } else {
                // Non-empty: Must match Color AND be Rank + 1
                if (solActiveCard.color === topCard.color) {
                    if (solActiveCard.rank === topCard.rank + 1) {
                        isValid = true;
                    } else {
                         showSolMessage(`âŒ æ•¸å­—éœ€é€£è™Ÿ (ç¾åœ¨æ˜¯ ${topCard.rank})`);
                    }
                } else {
                    showSolMessage("âŒ é¡è‰²ä¸ç¬¦ï¼");
                }
            }

            if (isValid) {
                // Move card
                targetCol.push(solActiveCard);
                removeActiveCardFromHolding();
                
                // Check if column completed (12)
                if (solActiveCard.rank === 12) {
                    showSolMessage("ğŸŒŸ è©²åˆ—å®Œæˆï¼");
                    solColumnStates[colIndex] = true;
                    solCompletedCols++;
                    // Optional: Visual cleanup? Or leave 1-12 stack visible?
                    // Prompt says "ç›´åˆ°å®Œæˆ1-12". Keeping them visible is satisfying.
                    // To prevent overflow, maybe collapse them?
                    // Let's leave them.
                }
                
                solActiveCard = null;
                renderSolitaireBoard();
            }
        }

        function removeActiveCardFromHolding() {
            const idx = solHolding.findIndex(c => c.id === solActiveCard.id);
            if (idx > -1) {
                solHolding.splice(idx, 1);
            }
        }

        function showSolMessage(msg) {
            const el = document.getElementById('solitaire-message');
            el.innerText = msg;
            el.classList.remove('hidden');
            el.classList.add('animate-bounce');
            setTimeout(() => {
                el.classList.add('hidden');
                el.classList.remove('animate-bounce');
            }, 2000);
        }

        window.exitMiracleSolitaire = function() {
            solColumns = [[], [], [], []]; // Clear
            showGameHub();
        }

        // --- 1. æ ¸å¿ƒä¿®å¾©ï¼šè¦–è¦ºè£œå„Ÿæ³•èˆ‡ç•«é¢é–ƒçˆä¿®å¾© (Moved to Bottom) ---
        window.addEventListener('load', () => {
            if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
            const wrapper = document.getElementById('scroll-wrapper');
            if(wrapper) wrapper.scrollTop = 0;
            const appRoot = document.getElementById('app-root');
            if(appRoot) appRoot.style.opacity = '1';
            showHome(); // ç¢ºä¿é‚è¼¯åŸ·è¡Œ
            loadAllData();
            initStars();
        });

        window.addEventListener('resize', () => {
            const bgLayer = document.getElementById('bg-layer');
            if(bgLayer) { bgLayer.style.height = window.innerHeight + 'px'; }
        });
    </script>
</body>
</html>
